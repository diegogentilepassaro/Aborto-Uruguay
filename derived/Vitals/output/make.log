
 make.py started: 2020-03-25 12:24:19 C:\Users\diegog\Desktop\Diego\Aborto-Uruguay\derived\Vitals\code 




Execute:  StataMP-64 /e do "./assign_treatment.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./assign_treatment.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main 
  1.     import_treatment_dates
  2.     assign_treatment
  3.     
.     save_data ../temp/vital_birth_records.dta, key(birth_id) replace
  4. end

. 
. program import_treatment_dates
  1.     import excel ../../../raw/timeline_implementation.xlsx, clear firstrow
>  cellrange(D1:E14)
  2.     keep if !mi(impl_date)
  3.     
.     bys dpto: egen impl_date_dpto = min(impl_date)
  4.     gen IS_impl_date = impl_date_dpto
  5.     format %td IS_impl_date
  6. 
.     keep dpto IS_impl_date
  7.     duplicates drop
  8.     save_data ../temp/timeline_implementation.dta, key(dpto) replace
  9. 
.     import excel ../../../raw/control_impl_dates.xlsx, clear firstrow
 10.     keep dpto impl_date
 11.         keep if !missing(dpto)
 12.     save_data ../temp/timeline_control_implementation.dta, key(dpto) repla
> ce
 13. end

. 
. program assign_treatment
  1.     use ../../../base/Vitals/output/vital_birth_records.dta, clear
  2.     merge m:1 dpto using ../temp/timeline_implementation.dta, ///
>         keepusing(IS_impl_date)
  3.     gen montevideo = (dpto == 1)        
  4.     gen treated = (_merge == 3 & dpto != 1)
  5.     drop _merge
  6.     merge m:1 dpto using ../temp/timeline_control_implementation.dta, ///
>         keepusing(impl_date)
  7.     replace IS_impl_date = impl_date if _merge == 3
  8.     gen control = (_merge == 3)
  9.     drop impl_date _merge
 10.     gen treated_or_control = (treated == 1 | control == 1)
 11.     
.     relative_time, event_date(IS_impl_date) time(anio_qtr) time_fun(qofd) win
> dow(12)
 12.     relative_time, event_date(IS_impl_date) time(anio_sem) time_fun(hofd) 
> window(6)
 13.     relative_time, event_date(IS_impl_date) time(anio) time_fun(yofd) wind
> ow(4)
 14. 
.     /*gen VTP_impl_date = td(01jan2013)
>     format %td VTP_impl_date*/
. end

. 
. program relative_time
  1.     syntax, event_date(str) time(str) time_fun(str) window(int) 
  2.   
.     gen rel_t_`time' = `time' - `time_fun'(`event_date') if !missing(IS_impl_
> date)
  3.     bysort dpto: gen post_`time' = (`time' >= `time_fun'(`event_date'))   
>  
  4.     replace rel_t_`time' = -1000    if rel_t_`time' < -`window' & !missing
> (IS_impl_date)
  5.     replace rel_t_`time' = 1000 if rel_t_`time' >  `window' & !missing(IS_
> impl_date)
  6.     replace rel_t_`time' = rel_t_`time' + `window' + 1 if ///
>         (rel_t_`time' != -1000 & rel_t_`time' != 1000 & !missing(IS_impl_date
> )) ///
>         
  7.     replace rel_t_`time' = 0 if rel_t_`time' == -1000 & !missing(IS_impl_d
> ate)
  8.     assert !mi(rel_t_`time') if !missing(IS_impl_date)
  9.     tab rel_t_`time', m
 10. end

. 
. * EXECUTE
. main
(3 observations deleted)

Duplicates in terms of all variables

(5 observations deleted)
(data already sorted by dpto)
  variable IS_impl_date was float now int
  (10 bytes saved)
===============================================================================
> ===================
File: ../temp/timeline_implementation.dta
Key: dpto
===============================================================================
> ===================
  5:2(47831):3244004639:1048402393

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        dpto |          5         8.2    6.379655          1         16
IS_impl_date |          5     17373.2    865.7868      16162      18414




(note: file ../temp/timeline_implementation.dta not found)
file ../temp/timeline_implementation.dta saved
(4 observations deleted)
(data now sorted by dpto)
  (0 bytes saved)
===============================================================================
> ===================
File: ../temp/timeline_control_implementation.dta
Key: dpto
===============================================================================
> ===================
  6:2(32042):2513045499:454669562

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        dpto |          6    6.166667    3.060501          2         10
   impl_date |          6    17440.33    1034.405      16162      18414




(note: file ../temp/timeline_control_implementation.dta not found)
file ../temp/timeline_control_implementation.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                       299,152
        from master                   299,152  (_merge==1)
        from using                          0  (_merge==2)

    matched                           527,564  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       700,645
        from master                   700,645  (_merge==1)
        from using                          0  (_merge==2)

    matched                           126,071  (_merge==3)
    -----------------------------------------
(126,071 real changes made)
(173,081 missing values generated)
(140,221 real changes made)
(277,426 real changes made)
(235,988 real changes made)
(140,221 real changes made)

rel_t_anio_ |
        qtr |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    140,221       16.96       16.96
          1 |      9,837        1.19       18.15
          2 |     10,070        1.22       19.37
          3 |      9,564        1.16       20.53
          4 |      9,933        1.20       21.73
          5 |      9,530        1.15       22.88
          6 |      9,853        1.19       24.07
          7 |      9,857        1.19       25.26
          8 |      9,709        1.17       26.44
          9 |      9,493        1.15       27.59
         10 |      9,349        1.13       28.72
         11 |      9,432        1.14       29.86
         12 |      9,265        1.12       30.98
         13 |      9,219        1.12       32.09
         14 |      9,213        1.11       33.21
         15 |      9,409        1.14       34.35
         16 |      9,228        1.12       35.46
         17 |      8,921        1.08       36.54
         18 |      9,109        1.10       37.64
         19 |      9,075        1.10       38.74
         20 |      9,382        1.13       39.88
         21 |      9,174        1.11       40.99
         22 |      9,327        1.13       42.11
         23 |      9,471        1.15       43.26
         24 |      9,503        1.15       44.41
         25 |      9,065        1.10       45.51
       1000 |    277,426       33.56       79.06
          . |    173,081       20.94      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(173,081 missing values generated)
(130,933 real changes made)
(276,772 real changes made)
(245,930 real changes made)
(130,933 real changes made)

rel_t_anio_ |
        sem |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    130,933       15.84       15.84
          1 |     19,777        2.39       18.23
          2 |     19,592        2.37       20.60
          3 |     19,440        2.35       22.95
          4 |     19,783        2.39       25.34
          5 |     19,144        2.32       27.66
          6 |     18,786        2.27       29.93
          7 |     18,401        2.23       32.16
          8 |     18,737        2.27       34.42
          9 |     18,133        2.19       36.62
         10 |     18,243        2.21       38.82
         11 |     18,491        2.24       41.06
         12 |     18,836        2.28       43.34
         13 |     18,567        2.25       45.59
       1000 |    276,772       33.48       79.06
          . |    173,081       20.94      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(173,081 missing values generated)
(89,595 real changes made)
(223,032 real changes made)
(341,008 real changes made)
(89,595 real changes made)

 rel_t_anio |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     89,595       10.84       10.84
          1 |     40,038        4.84       15.68
          2 |     39,367        4.76       20.44
          3 |     39,215        4.74       25.19
          4 |     37,984        4.59       29.78
          5 |     37,131        4.49       34.27
          6 |     36,333        4.39       38.67
          7 |     37,313        4.51       43.18
          8 |     36,650        4.43       47.61
          9 |     36,977        4.47       52.09
       1000 |    223,032       26.98       79.06
          . |    173,081       20.94      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(data now sorted by birth_id)
  variable montevideo was float now byte
  variable treated was float now byte
  variable control was float now byte
  variable treated_or_control was float now byte
  variable rel_t_anio_qtr was float now int
  variable post_anio_qtr was float now byte
  variable rel_t_anio_sem was float now int
  variable post_anio_sem was float now byte
  variable rel_t_anio was float now int
  variable post_anio was float now byte
  (22,321,332 bytes saved)
===============================================================================
> ===================
File: ../temp/vital_birth_records.dta
Key: birth_id
===============================================================================
> ===================
  826716:41(62921):309378102:1196176587

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    826,716    413421.2    238687.5          1     826836
        anio |    826,716     2006.86    4.967449       1999       2015
       edadm |    826,716    26.74744    6.697713         10         53
        dpto |    826,716    5.498114    5.884505          1         19
dpto_resid~e |    825,062    5.959725    5.834057          1         19
-------------+---------------------------------------------------------
     married |    775,715    .3600936    .4800276          0          1
 not_married |    775,715    .6399064    .4800276          0          1
     partner |    775,715    .7601284    .4270052          0          1
  no_partner |    775,715    .2398716    .4270052          0          1
      single |    775,715    .3237826    .4679185          0          1
-------------+---------------------------------------------------------
 prim_school |    826,716    .6226903    .4847137          0          1
 high_school |    826,716    .1598759    .3664912          0          1
    anio_qtr |    826,716     188.927    19.90053        156        223
    anio_sem |    826,716    94.21575    9.947281         78        111
recomm_pre~s |    816,036    .8047206    .3964159          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    775,089    .5479913    .4976918          0          1
no_prenata~e |    816,036    .0385743    .1925782          0          1
first_preg~y |    821,587    .3747175    .4840502          0          1
 kids_before |    821,587    .6252825    .4840502          0          1
lowbirthwe~t |    822,191    .0820308    .2744118          0          1
-------------+---------------------------------------------------------
  apgar1_low |    818,085     .046082    .2096629          0          1
  apgar2_low |    818,066    .0100432    .0997113          0          1
preg_preterm |    813,527    .0921174    .2891918          0          1
       young |    826,716    .6901584    .4624284          0          1
       adult |    826,716    .3042133    .4600737          0          1
-------------+---------------------------------------------------------
   age_group |    826,716     24.7537     6.84487         10         50
     age_min |    826,716     24.7537     6.84487         10         50
     age_max |    826,716    28.75364    6.844668         14         53
public_hea~h |    826,716    .4162385    .4929344          0          1
     pereira |    826,716    .1560935    .3629442          0          1
-------------+---------------------------------------------------------
IS_impl_date |    653,635    16609.97    791.5939      16162      18414
  montevideo |    826,716    .5101208    .4998979          0          1
     treated |    826,716    .1280234    .3341161          0          1
     control |    826,716    .1524961    .3595014          0          1
treated_or~l |    826,716    .2805195    .4492534          0          1
-------------+---------------------------------------------------------
rel_t_anio~r |    653,635    429.0703    490.3194          0       1000
post_anio_~r |    826,716    .4808447    .4996332          0          1
rel_t_anio~m |    653,635    426.0359    491.8863          0       1000
post_anio_~m |    826,716    .4913175    .4999249          0          1
  rel_t_anio |    653,635     343.787    472.2764          0       1000
-------------+---------------------------------------------------------
   post_anio |    826,716    .4928367     .499949          0          1




(note: file ../temp/vital_birth_records.dta not found)
file ../temp/vital_birth_records.dta saved

. 
end of do-file


Execute:  StataMP-64 /e do "./create_vitals_panels.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./create_vitals_panels.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main
  1.     use ../temp/vital_birth_records.dta, clear
  2. 
.     sample_restrictions
  3.     save_data ../output/births.dta, key(birth_id) replace
  4.         
.     preserve
  5.     keep if treated_or_control == 1
  6.     drop treated_or_control control montevideo pereira
  7.     save_data ../output/births_treated_control.dta, key(birth_id) replace
  8.     restore
  9. 
.     keep if montevideo == 1
 10.     drop treated_or_control treated control montevideo
 11.     save_data ../output/births_mvd.dta, key(birth_id) replace
 12. end 

. 
. program sample_restrictions
  1.     keep if inrange(edad, 15, 44)
  2.     drop if inlist(dpto,20,99)
  3. end

. 
. * EXECUTE
. main
(4,653 observations deleted)
(0 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births.dta
Key: birth_id
===============================================================================
> ===================
  822063:41(62921):3817194720:3997583299

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    822,063    414353.8    237344.1       3260     825442
        anio |    822,063     2006.86    4.968458       1999       2015
       edadm |    822,063    26.76638    6.619383         15         44
        dpto |    822,063    5.492148    5.881884          1         19
dpto_resid~e |    820,422    5.953677    5.831774          1         19
-------------+---------------------------------------------------------
     married |    771,409    .3610627     .480309          0          1
 not_married |    771,409    .6389373     .480309          0          1
     partner |    771,409    .7614521     .426196          0          1
  no_partner |    771,409    .2385479     .426196          0          1
      single |    771,409    .3226654    .4674962          0          1
-------------+---------------------------------------------------------
 prim_school |    822,063    .6223671    .4847954          0          1
 high_school |    822,063    .1604719    .3670434          0          1
    anio_qtr |    822,063    188.9279    19.90457        156        223
    anio_sem |    822,063    94.21621     9.94928         78        111
recomm_pre~s |    811,444     .805485    .3958271          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    770,794     .549113    .4975824          0          1
no_prenata~e |    811,444    .0385313    .1924752          0          1
first_preg~y |    816,963    .3728431    .4835612          0          1
 kids_before |    816,963    .6271569    .4835612          0          1
lowbirthwe~t |    817,561    .0816294    .2737994          0          1
-------------+---------------------------------------------------------
  apgar1_low |    813,486    .0459442    .2093643          0          1
  apgar2_low |    813,470    .0099979    .0994885          0          1
preg_preterm |    808,953    .0916382    .2885147          0          1
       young |    822,063    .6940648    .4608027          0          1
       adult |    822,063    .3059352    .4608027          0          1
-------------+---------------------------------------------------------
   age_group |    822,063    24.77758    6.748784         15         40
     age_min |    822,063    24.77758    6.748784         15         40
     age_max |    822,063    28.77758    6.748784         19         44
public_hea~h |    822,063    .4150558     .492732          0          1
     pereira |    822,063    .1557898    .3626561          0          1
-------------+---------------------------------------------------------
IS_impl_date |    650,322    16609.14      790.75      16162      18414
  montevideo |    822,063    .5106056    .4998878          0          1
     treated |    822,063    .1280693    .3341671          0          1
     control |    822,063    .1524105    .3594185          0          1
treated_or~l |    822,063    .2804797    .4492339          0          1
-------------+---------------------------------------------------------
rel_t_anio~r |    650,322    429.2289    490.3439          0       1000
post_anio_~r |    822,063    .4811845    .4996462          0          1
rel_t_anio~m |    650,322    426.1917    491.9106          0       1000
post_anio_~m |    822,063    .4916594    .4999307          0          1
  rel_t_anio |    650,322      343.97    472.3376          0       1000
-------------+---------------------------------------------------------
   post_anio |    822,063      .49318    .4999538          0          1




(note: file ../output/births.dta not found)
file ../output/births.dta saved
(591,491 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births_treated_control.dta
Key: birth_id
===============================================================================
> ===================
  230572:37(67754):2364513009:3246349313

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    230,572    400812.4    235263.1       3267     825439
        anio |    230,572    2006.744    4.945789       1999       2015
       edadm |    230,572     26.3809    6.550465         15         44
        dpto |    230,572     7.22118    4.299437          2         16
dpto_resid~e |    229,868    7.268015    4.375482          1         19
-------------+---------------------------------------------------------
     married |    222,791    .3446997    .4752713          0          1
 not_married |    222,791    .6553003    .4752713          0          1
     partner |    222,791    .7395496    .4388814          0          1
  no_partner |    222,791    .2604504    .4388814          0          1
      single |    222,791    .3397085    .4736113          0          1
-------------+---------------------------------------------------------
 prim_school |    230,572     .673911    .4687813          0          1
 high_school |    230,572    .1464271    .3535347          0          1
    anio_qtr |    230,572    188.4585     19.8127        156        223
    anio_sem |    230,572    93.98202    9.904026         78        111
recomm_pre~s |    228,427    .8140062    .3891025          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    219,166    .5056031    .4999697          0          1
no_prenata~e |    228,427    .0297951    .1700219          0          1
first_preg~y |    229,781    .3538587     .478167          0          1
 kids_before |    229,781    .6461413     .478167          0          1
lowbirthwe~t |    229,290    .0639321    .2446325          0          1
-------------+---------------------------------------------------------
  apgar1_low |    227,874    .0378762    .1908972          0          1
  apgar2_low |    227,903      .00896    .0942322          0          1
preg_preterm |    226,590    .0753387    .2639377          0          1
       young |    230,572    .7216748    .4481754          0          1
       adult |    230,572    .2783252    .4481754          0          1
-------------+---------------------------------------------------------
   age_group |    230,572    24.39054    6.682353         15         40
     age_min |    230,572    24.39054    6.682353         15         40
     age_max |    230,572    28.39054    6.682353         19         44
public_hea~h |    230,572     .441142    .4965247          0          1
IS_impl_date |    230,572    17423.13    858.5101      16162      18414
-------------+---------------------------------------------------------
     treated |    230,572    .4566079    .4981146          0          1
rel_t_anio~r |    230,572    292.3547    449.8175          0       1000
post_anio_~r |    230,572    .4716791    .4991984          0          1
rel_t_anio~m |    230,572    287.4925    449.7422          0       1000
post_anio_~m |    230,572    .4835539    .4997305          0          1
-------------+---------------------------------------------------------
  rel_t_anio |    230,572    208.8429    403.3359          0       1000
   post_anio |    230,572    .4889752    .4998795          0          1




(note: file ../output/births_treated_control.dta not found)
file ../output/births_treated_control.dta saved
(402,313 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births_mvd.dta
Key: birth_id
===============================================================================
> ===================
  419750:37(53499):2665022691:1652829000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    419,750    433644.2    236387.7       3260     825442
        anio |    419,750    2006.998    4.971967       1999       2015
       edadm |    419,750    27.31295    6.598156         15         44
        dpto |    419,750           1           0          1          1
dpto_resid~e |    419,148    1.991509    2.852758          1         19
-------------+---------------------------------------------------------
     married |    380,730     .385013     .486599          0          1
 not_married |    380,730     .614987     .486599          0          1
     partner |    380,730    .7875529    .4090401          0          1
  no_partner |    380,730    .2124471    .4090401          0          1
      single |    380,730    .3027027    .4594283          0          1
-------------+---------------------------------------------------------
 prim_school |    419,750    .5618297     .496163          0          1
 high_school |    419,750    .1832353    .3868597          0          1
    anio_qtr |    419,750    189.4881    19.91799        156        223
    anio_sem |    419,750    94.49526    9.955888         78        111
recomm_pre~s |    413,716    .8033385    .3974747          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    390,888     .592515    .4913671          0          1
no_prenata~e |    413,716    .0451203    .2075683          0          1
first_preg~y |    416,195    .3924122    .4882883          0          1
 kids_before |    416,195    .6075878    .4882883          0          1
lowbirthwe~t |    417,640    .0967221    .2955793          0          1
-------------+---------------------------------------------------------
  apgar1_low |    416,230    .0555702    .2290902          0          1
  apgar2_low |    416,259    .0111277    .1048994          0          1
preg_preterm |    414,251    .1030559    .3040322          0          1
       young |    419,750    .6603979    .4735748          0          1
       adult |    419,750    .3396021    .4735748          0          1
-------------+---------------------------------------------------------
   age_group |    419,750    25.32312     6.73257         15         40
     age_min |    419,750    25.32312     6.73257         15         40
     age_max |    419,750    29.32312     6.73257         19         44
public_hea~h |    419,750    .3457534    .4756138          0          1
     pereira |    419,750    .3051078    .4604536          0          1
-------------+---------------------------------------------------------
IS_impl_date |    419,750       16162           0      16162      16162
rel_t_anio~r |    419,750    504.4149    495.4019          0       1000
post_anio_~r |    419,750    .6832829    .4651966          0          1
rel_t_anio~m |    419,750    502.3803    497.4097          0       1000
post_anio_~m |    419,750    .6972746     .459438          0          1
-------------+---------------------------------------------------------
  rel_t_anio |    419,750    418.1963    490.6674          0       1000
   post_anio |    419,750    .6972746     .459438          0          1




(note: file ../output/births_mvd.dta not found)
file ../output/births_mvd.dta saved

. 
end of do-file

 make.py ended: 2020-03-25 12:24:32
