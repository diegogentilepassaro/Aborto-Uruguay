
 make.py started: 2020-03-22 14:52:57 C:\Users\diegog\Desktop\Diego\Aborto-Uruguay\derived\Vitals\code 




Execute:  StataMP-64 /e do "./assign_treatment.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./assign_treatment.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main 
  1.     import_treatment_dates
  2.     assign_treatment
  3.     
.     save_data ../temp/vital_birth_records.dta, key(birth_id) replace
  4. end

. 
. program import_treatment_dates
  1.     import excel ../../../raw/timeline_implementation.xlsx, clear firstrow
>  cellrange(D1:E14)
  2.     keep if !mi(impl_date)
  3.     
.     bys dpto: egen impl_date_dpto = min(impl_date)
  4.     gen IS_impl_date = impl_date_dpto
  5.     format %td IS_impl_date
  6. 
.     keep dpto IS_impl_date
  7.     duplicates drop
  8.     save_data ../temp/timeline_implementation.dta, key(dpto) replace
  9. 
.     import excel ../../../raw/control_impl_dates.xlsx, clear firstrow
 10.     keep dpto impl_date
 11.     save_data ../temp/timeline_control_implementation.dta, key(dpto) repla
> ce
 12. end

. 
. program assign_treatment
  1.     use ../../../base/Vitals/output/vital_birth_records.dta, clear
  2.     merge m:1 dpto using ../temp/timeline_implementation.dta, ///
>         keepusing(IS_impl_date)
  3.     gen montevideo = (dpto == 1)        
  4.     gen treated = (_merge == 3 & dpto != 1)
  5.     drop _merge
  6.     merge m:1 dpto using ../temp/timeline_control_implementation.dta, ///
>         keepusing(impl_date)
  7.     replace IS_impl_date = impl_date if _merge == 3
  8.     gen control = (_merge == 3)
  9.     drop impl_date _merge
 10.     gen treated_or_control = (treated == 1 | control == 1)
 11.     
.     relative_time, event_date(IS_impl_date) time(anio_qtr) time_fun(qofd) win
> dow(12)
 12.     relative_time, event_date(IS_impl_date) time(anio_sem) time_fun(hofd) 
> window(6)
 13.     relative_time, event_date(IS_impl_date) time(anio) time_fun(yofd) wind
> ow(4)
 14. 
.     /*gen VTP_impl_date = td(01jan2013)
>     format %td VTP_impl_date*/
. end

. 
. program relative_time
  1.     syntax, event_date(str) time(str) time_fun(str) window(int) 
  2.   
.     gen rel_t_`time' = `time' - `time_fun'(`event_date') if !missing(IS_impl_
> date)
  3.     bysort dpto: gen post_`time' = (`time' >= `time_fun'(`event_date'))   
>  
  4.     replace rel_t_`time' = -1000    if rel_t_`time' < -`window' & !missing
> (IS_impl_date)
  5.     replace rel_t_`time' = 1000 if rel_t_`time' >  `window' & !missing(IS_
> impl_date)
  6.     replace rel_t_`time' = rel_t_`time' + `window' + 1 if ///
>         (rel_t_`time' != -1000 & rel_t_`time' != 1000 & !missing(IS_impl_date
> )) ///
>         
  7.     replace rel_t_`time' = 0 if rel_t_`time' == -1000 & !missing(IS_impl_d
> ate)
  8.     assert !mi(rel_t_`time') if !missing(IS_impl_date)
  9.     tab rel_t_`time', m
 10. end

. 
. * EXECUTE
. main
(3 observations deleted)

Duplicates in terms of all variables

(5 observations deleted)
(data already sorted by dpto)
  variable IS_impl_date was float now int
  (10 bytes saved)
===============================================================================
> ===================
File: ../temp/timeline_implementation.dta
Key: dpto
===============================================================================
> ===================
  5:2(47831):3244004639:1048402393

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        dpto |          5         8.2    6.379655          1         16
IS_impl_date |          5     17373.2    865.7868      16162      18414




(note: file ../temp/timeline_implementation.dta not found)
file ../temp/timeline_implementation.dta saved
(data now sorted by dpto)
  (0 bytes saved)
===============================================================================
> ===================
File: ../temp/timeline_control_implementation.dta
Key: dpto
===============================================================================
> ===================
  4:2(32042):140096628:1429260735

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        dpto |          4        4.75    2.217356          2          7
   impl_date |          4     18079.5    386.2473      17745      18414




(note: file ../temp/timeline_control_implementation.dta not found)
file ../temp/timeline_control_implementation.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                       299,152
        from master                   299,152  (_merge==1)
        from using                          0  (_merge==2)

    matched                           527,564  (_merge==3)
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                       763,484
        from master                   763,484  (_merge==1)
        from using                          0  (_merge==2)

    matched                            63,232  (_merge==3)
    -----------------------------------------
(63,232 real changes made)
(235,920 missing values generated)
(129,124 real changes made)
(248,736 real changes made)
(212,936 real changes made)
(129,124 real changes made)

rel_t_anio_ |
        qtr |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    129,124       15.62       15.62
          1 |      8,900        1.08       16.70
          2 |      9,124        1.10       17.80
          3 |      8,584        1.04       18.84
          4 |      9,051        1.09       19.93
          5 |      8,587        1.04       20.97
          6 |      8,964        1.08       22.06
          7 |      8,907        1.08       23.13
          8 |      8,807        1.07       24.20
          9 |      8,551        1.03       25.23
         10 |      8,446        1.02       26.25
         11 |      8,503        1.03       27.28
         12 |      8,395        1.02       28.30
         13 |      8,303        1.00       29.30
         14 |      8,344        1.01       30.31
         15 |      8,474        1.03       31.34
         16 |      8,349        1.01       32.35
         17 |      8,060        0.97       33.32
         18 |      8,230        1.00       34.32
         19 |      8,139        0.98       35.30
         20 |      8,429        1.02       36.32
         21 |      8,258        1.00       37.32
         22 |      8,383        1.01       38.33
         23 |      8,489        1.03       39.36
         24 |      8,501        1.03       40.39
         25 |      8,158        0.99       41.38
       1000 |    248,736       30.09       71.46
          . |    235,920       28.54      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(235,920 missing values generated)
(120,624 real changes made)
(248,310 real changes made)
(221,862 real changes made)
(120,624 real changes made)

rel_t_anio_ |
        sem |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    120,624       14.59       14.59
          1 |     17,864        2.16       16.75
          2 |     17,680        2.14       18.89
          3 |     17,652        2.14       21.03
          4 |     17,913        2.17       23.19
          5 |     17,283        2.09       25.28
          6 |     16,988        2.05       27.34
          7 |     16,615        2.01       29.35
          8 |     16,944        2.05       31.40
          9 |     16,368        1.98       33.38
         10 |     16,394        1.98       35.36
         11 |     16,611        2.01       37.37
         12 |     16,933        2.05       39.42
         13 |     16,617        2.01       41.43
       1000 |    248,310       30.04       71.46
          . |    235,920       28.54      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(235,920 missing values generated)
(83,387 real changes made)
(199,664 real changes made)
(307,745 real changes made)
(83,387 real changes made)

 rel_t_anio |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     83,387       10.09       10.09
          1 |     36,280        4.39       14.47
          2 |     35,630        4.31       18.78
          3 |     35,478        4.29       23.08
          4 |     34,334        4.15       27.23
          5 |     33,526        4.06       31.28
          6 |     32,778        3.96       35.25
          7 |     33,532        4.06       39.31
          8 |     32,881        3.98       43.28
          9 |     33,306        4.03       47.31
       1000 |    199,664       24.15       71.46
          . |    235,920       28.54      100.00
------------+-----------------------------------
      Total |    826,716      100.00
(data now sorted by birth_id)
  variable montevideo was float now byte
  variable treated was float now byte
  variable control was float now byte
  variable treated_or_control was float now byte
  variable rel_t_anio_qtr was float now int
  variable post_anio_qtr was float now byte
  variable rel_t_anio_sem was float now int
  variable post_anio_sem was float now byte
  variable rel_t_anio was float now int
  variable post_anio was float now byte
  (22,321,332 bytes saved)
===============================================================================
> ===================
File: ../temp/vital_birth_records.dta
Key: birth_id
===============================================================================
> ===================
  826716:41(62921):1103245694:1060321323

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    826,716    413421.2    238687.5          1     826836
        anio |    826,716     2006.86    4.967449       1999       2015
       edadm |    826,716    26.74744    6.697713         10         53
        dpto |    826,716    5.498114    5.884505          1         19
dpto_resid~e |    825,062    5.959725    5.834057          1         19
-------------+---------------------------------------------------------
     married |    775,715    .3600936    .4800276          0          1
 not_married |    775,715    .6399064    .4800276          0          1
     partner |    775,715    .7601284    .4270052          0          1
  no_partner |    775,715    .2398716    .4270052          0          1
      single |    775,715    .3237826    .4679185          0          1
-------------+---------------------------------------------------------
 prim_school |    826,716    .6226903    .4847137          0          1
 high_school |    826,716    .1598759    .3664912          0          1
    anio_qtr |    826,716     188.927    19.90053        156        223
    anio_sem |    826,716    94.21575    9.947281         78        111
recomm_pre~s |    816,036    .8047206    .3964159          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    775,089    .5479913    .4976918          0          1
no_prenata~e |    816,036    .0385743    .1925782          0          1
first_preg~y |    821,587    .3747175    .4840502          0          1
 kids_before |    821,587    .6252825    .4840502          0          1
lowbirthwe~t |    822,191    .0820308    .2744118          0          1
-------------+---------------------------------------------------------
  apgar1_low |    818,085     .046082    .2096629          0          1
  apgar2_low |    818,066    .0100432    .0997113          0          1
preg_preterm |    813,527    .0921174    .2891918          0          1
       young |    826,716    .6901584    .4624284          0          1
       adult |    826,716    .3042133    .4600737          0          1
-------------+---------------------------------------------------------
   age_group |    826,716     24.7537     6.84487         10         50
     age_min |    826,716     24.7537     6.84487         10         50
     age_max |    826,716    28.75364    6.844668         14         53
public_hea~h |    826,716    .4162385    .4929344          0          1
     pereira |    826,716    .1560935    .3629442          0          1
-------------+---------------------------------------------------------
IS_impl_date |    590,796    16625.44    805.9654      16162      18414
  montevideo |    826,716    .5101208    .4998979          0          1
     treated |    826,716    .1280234    .3341161          0          1
     control |    826,716    .0764858    .2657739          0          1
treated_or~l |    826,716    .2045092    .4033427          0          1
-------------+---------------------------------------------------------
rel_t_anio~r |    590,796     425.638    489.8257          0       1000
post_anio_~r |    826,716    .4316513    .4953067          0          1
rel_t_anio~m |    590,796    422.8892     491.412          0       1000
post_anio_~m |    826,716    .4412543    .4965373          0          1
  rel_t_anio |    590,796    340.5188    471.1911          0       1000
-------------+---------------------------------------------------------
   post_anio |    826,716    .4423369    .4966641          0          1




(note: file ../temp/vital_birth_records.dta not found)
file ../temp/vital_birth_records.dta saved

. 
end of do-file


Execute:  StataMP-64 /e do "./create_vitals_panels.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./create_vitals_panels.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main
  1.     use ../temp/vital_birth_records.dta, clear
  2. 
.     sample_restrictions
  3.     save_data ../output/births.dta, key(birth_id) replace
  4.         
.     preserve
  5.     keep if treated_or_control == 1
  6.     drop treated_or_control control montevideo pereira
  7.     save_data ../output/births_treated_control.dta, key(birth_id) replace
  8.     restore
  9. 
.     keep if montevideo == 1
 10.     drop treated_or_control treated control montevideo
 11.     save_data ../output/births_mvd.dta, key(birth_id) replace
 12. end 

. 
. program sample_restrictions
  1.     keep if inrange(edad, 15, 44)
  2.     drop if inlist(dpto,20,99)
  3. end

. 
. * EXECUTE
. main
(4,653 observations deleted)
(0 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births.dta
Key: birth_id
===============================================================================
> ===================
  822063:41(62921):2864825295:1008510609

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    822,063    414353.8    237344.1       3260     825442
        anio |    822,063     2006.86    4.968458       1999       2015
       edadm |    822,063    26.76638    6.619383         15         44
        dpto |    822,063    5.492148    5.881884          1         19
dpto_resid~e |    820,422    5.953677    5.831774          1         19
-------------+---------------------------------------------------------
     married |    771,409    .3610627     .480309          0          1
 not_married |    771,409    .6389373     .480309          0          1
     partner |    771,409    .7614521     .426196          0          1
  no_partner |    771,409    .2385479     .426196          0          1
      single |    771,409    .3226654    .4674962          0          1
-------------+---------------------------------------------------------
 prim_school |    822,063    .6223671    .4847954          0          1
 high_school |    822,063    .1604719    .3670434          0          1
    anio_qtr |    822,063    188.9279    19.90457        156        223
    anio_sem |    822,063    94.21621     9.94928         78        111
recomm_pre~s |    811,444     .805485    .3958271          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    770,794     .549113    .4975824          0          1
no_prenata~e |    811,444    .0385313    .1924752          0          1
first_preg~y |    816,963    .3728431    .4835612          0          1
 kids_before |    816,963    .6271569    .4835612          0          1
lowbirthwe~t |    817,561    .0816294    .2737994          0          1
-------------+---------------------------------------------------------
  apgar1_low |    813,486    .0459442    .2093643          0          1
  apgar2_low |    813,470    .0099979    .0994885          0          1
preg_preterm |    808,953    .0916382    .2885147          0          1
       young |    822,063    .6940648    .4608027          0          1
       adult |    822,063    .3059352    .4608027          0          1
-------------+---------------------------------------------------------
   age_group |    822,063    24.77758    6.748784         15         40
     age_min |    822,063    24.77758    6.748784         15         40
     age_max |    822,063    28.77758    6.748784         19         44
public_hea~h |    822,063    .4150558     .492732          0          1
     pereira |    822,063    .1557898    .3626561          0          1
-------------+---------------------------------------------------------
IS_impl_date |    587,720    16624.42    805.0355      16162      18414
  montevideo |    822,063    .5106056    .4998878          0          1
     treated |    822,063    .1280693    .3341671          0          1
     control |    822,063    .0762581    .2654109          0          1
treated_or~l |    822,063    .2043274    .4032095          0          1
-------------+---------------------------------------------------------
rel_t_anio~r |    587,720    425.8467    489.8597          0       1000
post_anio_~r |    822,063    .4319073     .495342          0          1
rel_t_anio~m |    587,720    423.0986     491.446          0       1000
post_anio_~m |    822,063    .4415124    .4965677          0          1
  rel_t_anio |    587,720    340.7485    471.2697          0       1000
-------------+---------------------------------------------------------
   post_anio |    822,063    .4425938    .4966939          0          1




(note: file ../output/births.dta not found)
file ../output/births.dta saved
(654,093 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births_treated_control.dta
Key: birth_id
===============================================================================
> ===================
  167970:37(67754):4277540615:642591671

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    167,970    393866.7    236583.5       3267     825433
        anio |    167,970     2006.61    4.940843       1999       2015
       edadm |    167,970    26.18944     6.60024         15         44
        dpto |    167,970    6.693951    4.737811          2         16
dpto_resid~e |    167,329    6.763442    4.826411          1         19
-------------+---------------------------------------------------------
     married |    161,697    .3516392    .4774835          0          1
 not_married |    161,697    .6483608    .4774835          0          1
     partner |    161,697    .7204896    .4487601          0          1
  no_partner |    161,697    .2795104    .4487601          0          1
      single |    161,697    .3580339    .4794236          0          1
-------------+---------------------------------------------------------
 prim_school |    167,970    .6896172    .4626517          0          1
 high_school |    167,970    .1199559     .324911          0          1
    anio_qtr |    167,970    187.9241    19.79189        156        223
    anio_sem |    167,970      93.715    9.893331         78        111
recomm_pre~s |    166,419    .7994279    .4004296          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    158,899     .475925    .4994216          0          1
no_prenata~e |    166,419    .0325864    .1775521          0          1
first_preg~y |    167,274    .3464316    .4758341          0          1
 kids_before |    167,274    .6535684    .4758341          0          1
lowbirthwe~t |    167,032     .062036    .2412217          0          1
-------------+---------------------------------------------------------
  apgar1_low |    165,805    .0354211    .1848423          0          1
  apgar2_low |    165,815    .0087507    .0931354          0          1
preg_preterm |    165,694    .0735875    .2610991          0          1
       young |    167,970    .7289218    .4445177          0          1
       adult |    167,970    .2710782    .4445177          0          1
-------------+---------------------------------------------------------
   age_group |    167,970    24.19852     6.72543         15         40
     age_min |    167,970    24.19852     6.72543         15         40
     age_max |    167,970    28.19852     6.72543         19         44
public_hea~h |    167,970    .5057213    .4999688          0          1
IS_impl_date |    167,970    17779.98    630.8205      16892      18414
-------------+---------------------------------------------------------
     treated |    167,970    .6267845    .4836601          0          1
rel_t_anio~r |    167,970     229.508    415.1423          0       1000
post_anio_~r |    167,970    .4063047    .4911442          0          1
rel_t_anio~m |    167,970    224.9772    414.5165          0       1000
post_anio_~m |    167,970    .4183485    .4932895          0          1
-------------+---------------------------------------------------------
  rel_t_anio |    167,970    147.2097     350.743          0       1000
   post_anio |    167,970    .4236411    .4941364          0          1




(note: file ../output/births_treated_control.dta not found)
file ../output/births_treated_control.dta saved
(402,313 observations deleted)
(data already sorted by birth_id)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/births_mvd.dta
Key: birth_id
===============================================================================
> ===================
  419750:37(53499):2665022691:1652829000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    birth_id |    419,750    433644.2    236387.7       3260     825442
        anio |    419,750    2006.998    4.971967       1999       2015
       edadm |    419,750    27.31295    6.598156         15         44
        dpto |    419,750           1           0          1          1
dpto_resid~e |    419,148    1.991509    2.852758          1         19
-------------+---------------------------------------------------------
     married |    380,730     .385013     .486599          0          1
 not_married |    380,730     .614987     .486599          0          1
     partner |    380,730    .7875529    .4090401          0          1
  no_partner |    380,730    .2124471    .4090401          0          1
      single |    380,730    .3027027    .4594283          0          1
-------------+---------------------------------------------------------
 prim_school |    419,750    .5618297     .496163          0          1
 high_school |    419,750    .1832353    .3868597          0          1
    anio_qtr |    419,750    189.4881    19.91799        156        223
    anio_sem |    419,750    94.49526    9.955888         78        111
recomm_pre~s |    413,716    .8033385    .3974747          0          1
-------------+---------------------------------------------------------
recomm_pre~t |    390,888     .592515    .4913671          0          1
no_prenata~e |    413,716    .0451203    .2075683          0          1
first_preg~y |    416,195    .3924122    .4882883          0          1
 kids_before |    416,195    .6075878    .4882883          0          1
lowbirthwe~t |    417,640    .0967221    .2955793          0          1
-------------+---------------------------------------------------------
  apgar1_low |    416,230    .0555702    .2290902          0          1
  apgar2_low |    416,259    .0111277    .1048994          0          1
preg_preterm |    414,251    .1030559    .3040322          0          1
       young |    419,750    .6603979    .4735748          0          1
       adult |    419,750    .3396021    .4735748          0          1
-------------+---------------------------------------------------------
   age_group |    419,750    25.32312     6.73257         15         40
     age_min |    419,750    25.32312     6.73257         15         40
     age_max |    419,750    29.32312     6.73257         19         44
public_hea~h |    419,750    .3457534    .4756138          0          1
     pereira |    419,750    .3051078    .4604536          0          1
-------------+---------------------------------------------------------
IS_impl_date |    419,750       16162           0      16162      16162
rel_t_anio~r |    419,750    504.4149    495.4019          0       1000
post_anio_~r |    419,750    .6832829    .4651966          0          1
rel_t_anio~m |    419,750    502.3803    497.4097          0       1000
post_anio_~m |    419,750    .6972746     .459438          0          1
-------------+---------------------------------------------------------
  rel_t_anio |    419,750    418.1963    490.6674          0       1000
   post_anio |    419,750    .6972746     .459438          0          1




(note: file ../output/births_mvd.dta not found)
file ../output/births_mvd.dta saved

. 
end of do-file

 make.py ended: 2020-03-22 14:53:11
