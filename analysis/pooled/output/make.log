
 make.py started: 2020-03-07 17:59:15 C:\Users\dgentil1\Desktop\aborto_uru_repo\Aborto-Uruguay\analysis\pooled\code 




Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./pooled_plots.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./pooled_plots.do 

. clear all

. set more off

. 
. program main
  1.         qui do ../../globals.do
  2.         global controls = "nbr_people ind_under14 edad single poor blanco 
> public_health"
  3.         
.         create_births_data,     time(anio_sem) num_periods(6) by_vars(single 
> kids_before)
  4.         local outcomes = "GFR GFR_single0    GFR_single1    GFR_kids_befor
> e0    GFR_kids_before1 " + ///
>                                   " births births_single0 births_single1 birt
> hs_kids_before0 births_kids_before1 "
  5.         pooled_coefplot,   time(anio_sem) num_periods(6) data(births_wide)
>  ///
>             outcomes(`outcomes')
  6.         pooled_mean_plots, time(anio_sem) num_periods(6) outcomes(`outcome
> s')
  7.         pooled_coefplot,   time(anio_sem) num_periods(6) data(births_ind) 
> ///
>             outcomes(lowbirthweight apgar1_low recomm_prenatal_numvisits preg
> _preterm)
  8.         
.         local labor_vars   = "trabajo horas_trabajo work_part_time"
  9.         pooled_coefplot, data(ech_labor) time(anio_sem) num_periods(6) out
> comes(`labor_vars')
 10.         /*local educ_vars   = "educ_HS_diploma educ_anios_secun educ_some_
> college educ_anios_terc"
>         pooled_coefplot, data(ech_educ) time(anio_sem) num_periods(6) outcome
> s(`educ_vars')*/
. end

. 
. program create_births_data
  1. syntax, time(str) by_vars(str) num_periods(str)
  2.         compute_TFR, time(`time') by_vars(`by_vars')
  3.         use  ..\..\..\derived\Vitals\output\births_treated_control.dta, cl
> ear
  4.         save ../temp/plots_sample_births_ind.dta, replace
  5. 
.         foreach by_var in `by_vars' {
  6.                 forvalues i=0/1 {
  7.                         preserve
  8.                                 keep if !mi(`by_var') & `by_var'==`i'
  9.                                 collapse (count) births_`by_var'`i'_l=edad
> , by(`time' dpto treated)
 10.                                 gen births_`by_var'`i' = log(births_`by_va
> r'`i'_l)
 11.                                 lab var births_`by_var'`i'_l "Number of bi
> rths"
 12.                                 lab var births_`by_var'`i' "(log) Number o
> f births"
 13.                                 tempfile births_`by_var'`i'
 14.                                 save `births_`by_var'`i''
 15.                         restore
 16.                 }
 17.                 preserve
 18.                         keep if !mi(`by_var')
 19.                         collapse (count) births_l=edad (min) IS_impl_date,
>  by(`time' dpto treated `by_var')
 20.                         gen births = log(births_l)
 21.                         tempfile births_`by_var'
 22.                         save `births_`by_var''
 23.                 restore
 24.         }
 25. 
.         collapse (count) births_l=edad, by(`time' dpto treated)
 26.         gen births = log(births_l)
 27.         merge 1:1 `time' dpto using ..\temp\TFR_`time'.dta, assert(3) noge
> n
 28.         lab var births_l "Number of births"
 29.         lab var births "(log) Number of births"
 30.         tempfile births_agg
 31.         save `births_agg'
 32. 
.         merge 1:1 `time' dpto using `births_single0'      , assert(3) nogen
 33.         merge 1:1 `time' dpto using `births_single1'      , assert(3) noge
> n
 34.         merge 1:1 `time' dpto using `births_kids_before0' , assert(3) noge
> n
 35.         merge 1:1 `time' dpto using `births_kids_before1' , assert(3) noge
> n
 36.         assert births_l >= births_single0_l + births_single1_l
 37.         gen anio = year(dofh(anio_sem))
 38.         merge m:1 dpto anio using ..\..\..\derived\Time_state_panel\output
> \year_dpto_panel.dta, assert(2 3) keep(3) nogen
 39.         gen GFR = births_l/fertile_women_pop*1000
 40.         lab var GFR "General Fertility Rate"
 41.         foreach by_var in `by_vars' {
 42.                 merge m:1 dpto  anio using ../temp/sh_`by_var'.dta, assert
> (2 3) keep(3) nogen
 43.                 gen GFR_`by_var'1 = births_`by_var'1_l/(fertile_women_pop*
> (  pop_sh_`by_var'))*1000
 44.                 gen GFR_`by_var'0 = births_`by_var'0_l/(fertile_women_pop*
> (1-pop_sh_`by_var'))*1000 
 45.                 lab var GFR_`by_var'1 "General fertility rate"
 46.                 lab var GFR_`by_var'0 "General fertility rate"
 47.                 drop pop_sh_`by_var'
 48.         }
 49.         save ../temp/plots_sample_births_wide.dta, replace
 50.         
.         use `births_agg', clear 
 51.         gen all_sample = 1
 52.         append using `births_single'
 53.         append using `births_kids_before'
 54.         assert mi(single) & mi(all_sample) if !mi(kids_before)
 55.         if "`time'" == "anio_sem" {
 56.                 gen post = (`time' >= hofd(IS_impl_date))
 57.         }
 58.         else {
 59.                 gen post = (`time' >= yofd(IS_impl_date))
 60.         }
 61.         gen anio = year(dofh(anio_sem))
 62.         merge m:1 dpto anio using ..\..\..\derived\Time_state_panel\output
> \year_dpto_panel.dta, assert(2 3) keep(3) nogen
 63.         gen GFR = births_l/fertile_women_pop*1000 if all_sample==1
 64.         lab var GFR "General Fertility Rate"
 65.         foreach by_var in `by_vars' {
 66.                 merge m:1 dpto  anio using ../temp/sh_`by_var'.dta, assert
> (2 3) keep(3) nogen
 67.                 replace GFR = births_l/(fertile_women_pop*(  pop_sh_`by_va
> r'))*1000 if `by_var'==1 & mi(GFR)
 68.                 replace GFR = births_l/(fertile_women_pop*(1-pop_sh_`by_va
> r'))*1000 if `by_var'==0 & mi(GFR)
 69.                 drop pop_sh_`by_var'
 70.         }
 71.         save ../temp/plots_sample_births_long.dta, replace
 72. end

. 
. program compute_TFR
  1. syntax, time(str) by_vars(str)
  2.         use ..\..\..\derived\Vitals\output\births_treated_control.dta, cle
> ar
  3. 
.         if "`time'" == "anio_sem" {
  4.                 local time_label "Semesters"
  5.                 local times "anio anio_sem"
  6.         }
  7.         else {
  8.                 local time_label "Years"
  9.                 local times "anio"
 10.         }
 11. 
.         collapse (count) births=edad, by(`time' age_min age_max dpto IS_impl_
> date treated)      
 12.         isid `time' age_min age_max dpto
 13.         cap gen anio = year(dofh(`time'))
 14. 
.         merge m:1 dpto age_min age_max anio using ..\..\..\derived\Time_state
> _age_panel\output\year_dpto_age_panel.dta, keep(3)
 15.         gen TFR_agegroup = births/fertile_women_pop
 16. 
.         collapse (sum) TFR = TFR_agegroup, by(`times' dpto IS_impl_date treat
> ed)
 17.         isid `time' dpto
 18.         replace TFR = 5 * TFR
 19.         lab var TFR "Total Fertility Rate"
 20.         keep `time' dpto TFR
 21.         save ../temp/TFR_`time'.dta, replace
 22. 
.         foreach outcome in `by_vars' {
 23.                 use  ..\..\..\derived\ECH\output\main_ECH_panel.dta, clear
 24.                 collapse (count) pop_`outcome'=pers [pw=pesoan], by(anio d
> pto `outcome')
 25.                 egen tot_`outcome' = total(pop_`outcome'), by(anio dpto)
 26.                 gen pop_sh_`outcome' = pop/tot
 27.                 keep if `outcome'==1
 28.                 isid anio dpto
 29.                 keep anio dpto pop_sh_`outcome'
 30.                 keep if inrange(anio,2001,2015)
 31.                 save ../temp/sh_`outcome'.dta, replace
 32.         }
 33. end

. 
. capture program drop pooled_coefplot

. program              pooled_coefplot
  1. syntax, data(str) time(str) num_periods(int) outcomes(str) [groups_vars(st
> r) restr(str)]
  2. 
.         if substr("`data'",1,3) == "ech" {
  3.                 use  ..\..\..\derived\ECH\output\main_ECH_panel.dta, clear
  4.                 local all_controls = "c98_* c01_* ${controls}"
  5.                 if "`data'" == "ech_labor" {
  6.                         keep if hombre == 0 & inrange(horas_trabajo,0,100)
>  // & inrange(edad, 16, 45)
  7.                 }
  8.                 else {
  9.                         keep if hombre == 0 
 10.                 } 
 11.         }
 12.         else if "`data'" == "births_ind" {
 13.                 use ../temp/plots_sample_births_ind.dta, clear
 14.                 local all_controls = "c.edad i.tipoestab i.married i.high_
> school"
 15.         }
 16.         else  {
 17.                 use  ..\temp\plots_sample_births_wide.dta, clear
 18.                 local all_controls = ""
 19.                 tab dpto
 20.         }
 21.         relative_time, num_periods(`num_periods') time(`time') event_date(
> IS_impl_date)
 22.         local omitted = `num_periods' //tr_t = treatment*t
 23.         di "Omitted period: -1 (prior to implementation) or t=`omitted'."
 24. 
.         if "`time'" == "anio_sem" {
 25.                 local weight pesosem
 26.                 gen post = (`time' >= hofd(IS_impl_date))
 27.                 local time_label "Semesters relative to IS implementation"
 28.         }
 29.         else {
 30.                 local weight pesoan
 31.                 gen post = (`time' >= yofd(IS_impl_date))
 32.                 local time_label "Years relative to IS implementation"
 33.         }
 34.         if substr("`data'",1,3) == "ech" {
 35.                 local pweight = "[pw = `weight']"
 36.         }
 37.         else {
 38.                 local pweight = ""
 39.         }
 40.         
.         save ../temp/plots_sample_`data'.dta, replace
 41. 
.         local n_outcomes: word count `outcomes'
 42.     forval i = 1/`n_outcomes' {
 43.         local outcome: word `i' of `outcomes'
 44. 
.         use ../temp/plots_sample_`data'.dta, clear
 45.                 
.                 if substr("`outcome'",1,7) == "births_" {
 46.                         local ylabel = "ylabel(-1 (0.5) 0.5)"
 47.                 }
 48.                 else if substr("`outcome'",1,4) == "GFR_" {
 49.                         local ylabel = "ylabel(-20 (10) 20)"
 50.                 }
 51.                 else {
 52.                         local ylabel = ""
 53.                 }
 54. 
.                 if inlist("`outcome'","horas_trabajo","work_part_time") {
 55.             keep if trabajo==1
 56.         }
 57. 
.                 //local ES_subsample  = " if (treatment==1 | dpto==1)"
.                 //local ES_subsample_nomvd  = " if (treatment==1)"
.                 local DiD_subsample = " if !mi(treated)"
 58.                 local coefplot_opts = " vertical baselevels graphregion(co
> lor(white)) bgcolor(white) " + ///
>                                                           " xline(6.5 7.5, lc
> olor(black) lpattern(dot)) `ylabel' " + ///
>                                                           " ytitle(`: var lab
>  `outcome'') "
 59.                 
.                 * ES: run main regression and plot coefficients
.                 /*reg `outcome' ib`omitted'.t i.`time' i.dpto  ///
>                         `ES_subsample_nomvd' `pweight', vce(cluster dpto)
>                         * Coef plot
>                     coefplot, `coefplot_opts' xtitle("`time_label'") ///
>                                 drop(_cons 1.t 1000.t *.`time' *.dpto  `all_c
> ontrols') ///
>                                 xlabel(1 "-6" 3 "-4" 5 "-2" 7 "0" 9 "2" 11 "4
> " 13 "6") 
>                         graph export ../output/pooled_es_`outcome'_`time'_nom
> vd.pdf, replace
> 
>                 reg `outcome' ib`omitted'.t i.`time' i.dpto  ///
>                         `ES_subsample' `pweight', vce(cluster dpto)
>                         * Coef plot
> 
>                     coefplot, `coefplot_opts' xtitle("`time_label'") ///
>                                 drop(_cons 1.t 1000.t *.`time' *.dpto  `all_c
> ontrols') ///
>                                 xlabel(1 "-6" 3 "-4" 5 "-2" 7 "0" 9 "2" 11 "4
> " 13 "6") 
>                         graph export ../output/pooled_es_`outcome'_`time'.pdf
> , replace
>                         * Coef plot with shift
>                         qui sum `outcome' if inrange(t, 1, `num_periods')
>                         local target_mean = r(mean)
>                         preserve
>                             coefplot, omitted vertical baselevels gen ///
>                                         drop(_cons 1.t 1000.t *.`time' *.dpto
>  `all_controls')
>                             qui sum __b
>                             local coef_mean = r(mean)
>                         restore 
>                         local yshift = `target_mean' - `coef_mean'
>                         coefplot, `coefplot_opts' xtitle("`time_label'") ///
>                                 drop(_cons 1.t 1000.t *.`time' *.dpto `all_co
> ntrols') ///
>                             transform(*= "@ + `yshift'") yline(`target_mean',
>  lpattern(dashed)) ///
>                                 xlabel(1 "-6" 3 "-4" 5 "-2" 7 "0" 9 "2" 11 "4
> " 13 "6")                                  
>                         graph export ../output/pooled_es_shift_`outcome'_`tim
> e'.pdf, replace*/
.                         
.                 * DiD: run main regression and plot coefficientss
.                 reghdfe `outcome' ib`omitted'.t##i.treatment i.`time' i.dpto 
> `all_controls' ///
>                         `DiD_subsample' `pweight', noabsorb base cluster(dpto
> )
 60.                         
.                 * Coef plot
.                 coefplot, `coefplot_opts' xtitle("`time_label'") ///
>                         drop(_cons *.t 0.t#1.treatment 1000.t#1.treatment 1.t
> reatment 0.treatment *.`time' *.dpto `all_controls') ///
>             xlabel(1 "-6" 3 "-4" 5 "-2" 7 "0" 9 "2" 11 "4" 13 "6") 
 61.                 graph export ../output/pooled_did_`outcome'_`time'.pdf, re
> place
 62.                 
.                 * Coef plot with shift
.                 qui sum `outcome' if inrange(t, 1, `num_periods')
 63.                 local target_mean = r(mean)
 64.                 preserve
 65.                         coefplot, omitted vertical baselevels gen ///
>                                 drop(_cons *.t 0.t#1.treatment 1000.t#1.treat
> ment 1.treatment 0.treatment *.`time' *.dpto `all_controls')
 66.                         qui sum __b
 67.                         local coef_mean = r(mean)
 68.                 restore 
 69.                 local yshift = `target_mean' - `coef_mean'
 70.                 coefplot, `coefplot_opts' xtitle("`time_label'") ///
>                         drop(_cons *.t 0.t#1.treatment 1000.t#1.treatment 1.t
> reatment 0.treatment *.`time' *.dpto `all_controls') ///
>                         transform(*= "@ + `yshift'") yline(`target_mean', lpa
> ttern(dashed)) ///
>                         xlabel(1 "-6" 3 "-4" 5 "-2" 7 "0" 9 "2" 11 "4" 13 "6"
> )          
 71.                 graph export ../output/pooled_did_shift_`outcome'_`time'.p
> df, replace
 72.         }
 73. end

. 
. capture program drop relative_time

. program              relative_time
  1. syntax, num_periods(int) time(str) event_date(str)
  2.         if "`time'" == "anio_sem" {
  3.                 gen t = `time' - hofd(`event_date')
  4.         }
  5.         else {
  6.                 gen t = `time' - yofd(`event_date')
  7.         }
  8.         replace t = -1000    if t < -`num_periods'
  9.         replace t = 1000 if t >  `num_periods'
 10.         replace t = t + `num_periods' + 1 if (t != -1000 & t != 1000)
 11.         replace t = 0 if t == -1000
 12.         assert !mi(t)
 13.         tab t, m
 14. end

. 
. program pooled_mean_plots
  1. syntax, outcomes(str) time(str) num_periods(int)
  2.         use ../temp/plots_sample_births_wide.dta, clear
  3.         if "`time'" == "anio_sem" {
  4.                 local time_label "Semesters relative to IS implementation"
  5.         }
  6.         else {
  7.                 local time_label "Years relative to IS implementation"
  8.         }
  9.         
.         foreach outcome in `outcomes' {
 10.                 local opts "graphregion(color(white)) bgcolor(white) xline
> (7.5 8.5, lcolor(black) lpattern(dot)) ysize(3)"
 11.                 
.                 * Mean DiD
.                 egen T_`outcome' = mean(`outcome') if treatment==1, by(t)
 12.                 egen C_`outcome' = mean(`outcome') if treatment==0, by(t)
 13.                 sort t dpto treatment `by_var'
 14.                 gen     D_`outcome'   = T_`outcome' - C_`outcome'[_n-2] if
>  treatment==1
 15.                 lab var T_`outcome' "`: var lab `outcome''"
 16.                 lab var C_`outcome' "`: var lab `outcome''"
 17.                 lab var D_`outcome' "`: var lab `outcome''"
 18.                 tw (connected T_`outcome' t if inrange(t,2,14), sort mc(bl
> ue) lc(blue)) ///
>                    (connected C_`outcome' t if inrange(t,2,14), sort mc(red) 
>  lc(red)), ///
>                         legend(label(1 "Treatment") label( 2 "Control")) ///
>                         `opts' xtitle("`time_label'") xlabel(2 "-6" 4 "-4" 6 
> "-2" 8 "0" 10 "2" 12 "4" 14 "6")
 19.                 graph export ../output/pooled_did2_avg_`outcome'_`time'.pd
> f, replace
 20.                 tw connected D_`outcome' t if inrange(t,2,14), sort mc(blu
> e) lc(blue) ///
>                         `opts' xtitle("`time_label'") xlabel(2 "-6" 4 "-4" 6 
> "-2" 8 "0" 10 "2" 12 "4" 14 "6")
 21.                 graph export ../output/pooled_did_avg_`outcome'_`time'.pdf
> , replace
 22.                 
.                 * Mean ES
.                 egen         avg_`outcome' = mean(`outcome') if (treatment==1
> |dpto==1), by(t)
 23.                 lab var      avg_`outcome' "`: var lab `outcome''"
 24.                 tw connected avg_`outcome' t if inrange(t,2,14), sort mc(b
> lue) lc(blue) ///
>                         `opts' xtitle("`time_label'") xlabel(2 "-6" 4 "-4" 6 
> "-2" 8 "0" 10 "2" 12 "4" 14 "6")
 25.                 graph export ../output/pooled_es_avg_`outcome'_`time'.pdf,
>  replace
 26.                 
.                 egen         avg_`outcome'_2 = mean(`outcome') if (treatment=
> =1), by(t)
 27.                 lab var      avg_`outcome'_2 "`: var lab `outcome''"
 28.                 tw connected avg_`outcome'_2 t if inrange(t,2,14), sort mc
> (blue) lc(blue) ///
>                         `opts' xtitle("`time_label'") xlabel(2 "-6" 4 "-4" 6 
> "-2" 8 "0" 10 "2" 12 "4" 14 "6")
 29.                 graph export ../output/pooled_es_avg_`outcome'_`time'_nomv
> d.pdf, replace
 30.         }
 31. end

. 
. main

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                             1,632  (_merge==3)
    -----------------------------------------
(272 real changes made)
(note: file ../temp/TFR_anio_sem.dta not found)
file ../temp/TFR_anio_sem.dta saved
(120 observations deleted)
(0 observations deleted)
(note: file ../temp/sh_single.dta not found)
file ../temp/sh_single.dta saved
(120 observations deleted)
(0 observations deleted)
(note: file ../temp/sh_kids_before.dta not found)
file ../temp/sh_kids_before.dta saved
(note: file ../temp/plots_sample_births_ind.dta not found)
file ../temp/plots_sample_births_ind.dta saved
(64,166 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000002.tmp saved
(110,077 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000004.tmp saved
(6,273 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000006.tmp saved
(110,021 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000008.tmp saved
(58,645 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_0100000a.tmp saved
(696 observations deleted)
file C:\Users\dgentil1\AppData\Local\Temp\ST_0100000c.tmp saved
(label dpto already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_0100000d.tmp saved
(label dpto already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------
(label dpto already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------
(label dpto already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------
(label dpto already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               272  
    -----------------------------------------
merge:  after merge, not all observations from using or matched
        (merged result left in memory)
r(9);

end of do-file
r(9);


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./pooled_reg.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./pooled_reg.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata14\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata14\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main
  1.         qui do ..\..\globals.do
  2.         global controls = "nbr_people ind_under14 edad married poor blanco
>  public_health"
  3.         /*
>         local outcomes     = "trabajo horas_trabajo"
>         local data        = "ech"
>         local time        = "anio_sem"
>         local num_periods = "6"
>         */
.         local labor_vars   = "trabajo horas_trabajo work_part_time"
  4.         pooled_reg, outcomes(`labor_vars') data(ech_labor) time(anio_sem) 
> num_periods(6)
  5.         /*local educ_vars   = "educ_HS_diploma educ_anios_secun educ_some_
> college educ_anios_terc"
>         pooled_reg, outcomes(`educ_vars') data(ech_educ) time(anio_sem) num_p
> eriods(6)*/
.         pooled_reg, outcomes(births GFR) data(births_long) time(anio_sem) num
> _periods(6)
  6.         pooled_reg, outcomes(lowbirthweight apgar1_low recomm_prenatal_num
> visits preg_preterm) data(births_ind) time(anio_sem) num_periods(6)
  7. end

. 
. program pooled_reg
  1.     syntax, outcomes(str) data(str) time(str) num_periods(int)
  2.  
.         * Set locals
.         if "`time'" == "anio_sem" {
  3.                 local weight pesosem
  4.                 local time_label "Semesters relative to IS implementation"
  5.         }
  6.         else {
  7.                 local weight pesoan
  8.                 local time_label "Years relative to IS implementation"
  9.         }
 10.         if substr("`data'",1,3) == "ech" {
 11.                 local all_controls = "c98_* ${controls}" //note: using all
>  data, can't use c_0*
 12.                 local aweight = "[aw = `weight']"
 13.                 local cond_list "&!mi(dpto) &kids_before==1 &kids_before==
> 0 &single==0 &single==1"  /*"& young == 0" "& young == 1"*/
 14.                 if "`data'" == "ech_labor" {
 15.                         local age_group_list "_fertile _placebo"
 16.                 }
 17.                 else {
 18.                         local age_group_list "_fertile"
 19.                 }
 20.         }
 21.         else if "`data'" == "births_ind" {
 22.                 local all_controls = ""
 23.                 local aweight = ""
 24.                 local age_group_list "_fertile"
 25.                 local cond_list "&!mi(dpto) &kids_before==1 &kids_before==
> 0 &single==0 &single==1"
 26.         }
 27.         else {
 28.                 local all_controls = ""
 29.                 local aweight = ""
 30.                 local age_group_list "_fertile"
 31.                 local cond_list "&all_sample==1 &kids_before==1 &kids_befo
> re==0 &single==0 &single==1"
 32.         }
 33.         *local omitted = `num_periods'+1 //tr_t = treatment*t
.         
.         * Run regressions       
.         local n_outcomes: word count `outcomes'
 34.         clear matrix
 35.     forval i = 1/`n_outcomes' {
 36.         local outcome: word `i' of `outcomes'
 37. 
.         use ../temp/plots_sample_`data'.dta, clear
 38.         rename treatment treatment_fertile
 39.         local lab_v`i' : variable label `outcome'
 40.         local lab1_v`i': label (`outcome') 1
 41.                 
.         if inlist("`outcome'","horas_trabajo","work_part_time")  {
 42.             keep if trabajo==1
 43.         }
 44.         
.                 * Run main regression that plots coefficients
.                 /*reg `outcome' ib`omitted'.t##i.treatment i.`time' i.dpto  /
> //
>                                 `all_controls' if !mi(treatment) & inrange(ed
> ad, 16, 45) ///
>                                 `aweight', vce(cluster `time')*/
. 
.                 * Run regressions by subsamples
.                 foreach cond in `cond_list' {
 45.             
.             foreach age_group in `age_group_list' {
 46.                                 //local ES_subsample  = " if (treatment`ag
> e_group'==1 | (dpto==1 & age`age_group'==1)) "
.                                 local DiD_subsample = " if !mi(treatment`age_
> group') "
 47. 
.                                 di "*** REG: `outcome' , `cond' , `age_group'
>  ***"
 48. 
.                                 if inlist("`cond'","&!mi(dpto)","&all_sample=
> =1") {
 49.                                         //sum `outcome' `ES_subsample' `co
> nd', meanonly
.                                         //local avg_v`i'_ES`age_group' = r(me
> an)
.                                         sum `outcome' `DiD_subsample' `cond',
>  meanonly
 50.                                         local avg_v`i'_DiD`age_group' = r(
> mean)
 51.                                 }
 52. 
.                 /*reg `outcome' post i.dpto  ///
>                                         `ES_subsample' `cond' `aweight', vce(
> cluster dpto)
>                                 matrix COL_ES`age_group' = ((_b[post] \ _se[p
> ost]) \ e(N))*/
. 
.                 gen interaction = treatment`age_group' * post
 53. 
.                 reghdfe `outcome' i.treatment`age_group' i.post interaction /
> //
>                     i.`time' i.dpto  `all_controls' ///
>                     `DiD_subsample' `cond' `aweight', noabsorb cluster(`time'
>  dpto)
 54.                 
.                 matrix COL_DiD`age_group' = ((_b[interaction] \ _se[interacti
> on]) \ e(N))
 55.         
.                 drop interaction
 56.             }
 57.                         if "`data'" == "ech_labor" {
 58.                                 //matrix COL_ES  = (COL_ES_fertile,  COL_E
> S_placebo)
.                                 matrix COL_DiD = (COL_DiD_fertile, COL_DiD_pl
> acebo)
 59.                         }
 60.                         else {
 61.                                 //matrix COL_ES  = (COL_ES_fertile)
.                                 matrix COL_DiD = (COL_DiD_fertile)
 62.                         }
 63.             //matrix ROW_ES  = (nullmat(ROW_ES)  \ COL_ES)
.             matrix ROW_DiD = (nullmat(ROW_DiD) \ COL_DiD)
 64.                 }
 65.                 *local stub = substr("`outcome'",1,10)
.         //matrix TAB_ES  = (nullmat(TAB_ES) , ROW_ES)
.         matrix TAB_DiD = (nullmat(TAB_DiD), ROW_DiD)
 66.                 matrix drop ROW_DiD //ROW_ES
 67.     }
 68. 
.         local cond1            = "Baseline"
 69.         local cond4            = "Not single"
 70.         local cond5            = "Single"
 71.     if "`data'" == "ech_labor" {
 72.                 local cond2        = "Kids under 14"
 73.                 local cond3        = "No kids under 14"
 74.                 foreach rd in DiD { //ES
 75.                         file open myfile using "../output/tab_`rd'_`data'.
> txt", write replace
 76.                         file write myfile "\begin{threeparttable}" ///
>                                                         _n "\begin{tabular}{l
> |cc|cc|cc} \hline\hline"  ///
>                                                         _n " & \multicolumn{2
> }{c|}{`lab_v1'} & \multicolumn{2}{c}{`lab_v2'} & \multicolumn{2}{c}{`lab_v3'}
>  \\ \hline" ///
>                                                         _n " & (1)        & (
> 2)        & (3)        & (4)        & (5)        & (6)  \\ "  ///
>                                                         _n " & Age: 16-45 & A
> ge: 46-60 & Age: 16-45 & Age: 46-60 & Age: 16-45 & Age: 46-60 \\ \hline" ///
>                                                         _n "Mean (baseline) &
>  " %9.3f (`avg_v1_`rd'_fertile') " & " %9.3f (`avg_v1_`rd'_placebo') " & " //
> /
>                                                                              
>    %9.3f (`avg_v2_`rd'_fertile') " & " %9.3f (`avg_v2_`rd'_placebo') " & " //
> /
>                                                                              
>    %9.3f (`avg_v3_`rd'_fertile') " & " %9.3f (`avg_v3_`rd'_placebo') " \\ \hl
> ine "
 77.                         local r = rowsof(TAB_`rd') / 3
 78.                         forvalues i = 1/`r' {
 79.                                 local j1 = 3 * `i' - 2
 80.                                 local j2 = 3 * `i' - 1
 81.                                 local j3 = 3 * `i' 
 82.                                 file write myfile ///
>                                         _n "`cond`i'' &  " ///
>                                                       %9.3f  (TAB_`rd'[`j1',1
> ]) "  &  " %9.3f (TAB_`rd'[`j1',2]) " & " ///
>                               %9.3f  (TAB_`rd'[`j1',3]) "  &  " %9.3f (TAB_`r
> d'[`j1',4]) " & " ///
>                               %9.3f  (TAB_`rd'[`j1',5]) "  &  " %9.3f (TAB_`r
> d'[`j1',6]) " \\ " ///
>                         _n " & (" %9.3f  (TAB_`rd'[`j2',1]) ") & (" %9.3f (TA
> B_`rd'[`j2',2]) ") & (" ///
>                                   %9.3f  (TAB_`rd'[`j2',3]) ") & (" %9.3f (TA
> B_`rd'[`j2',4]) ") & (" ///
>                                   %9.3f  (TAB_`rd'[`j2',5]) ") & (" %9.3f (TA
> B_`rd'[`j2',6]) ") \\ " ///
>                         _n " &  " %9.0fc (TAB_`rd'[`j3',1]) "  &  " %9.0fc (T
> AB_`rd'[`j3',2]) " & " ///
>                                       %9.0fc (TAB_`rd'[`j3',3]) "  &  " %9.0f
> c (TAB_`rd'[`j3',4]) " & " ///
>                                       %9.0fc (TAB_`rd'[`j3',5]) "  &  " %9.0f
> c (TAB_`rd'[`j3',6]) " \\ "
 83.                         }
 84.                         file write myfile _n "\hline\hline" _n "\end{tabul
> ar}" 
 85.                         file close myfile
 86.                 }       
 87.         }
 88.     else if "`data'" == "ech_educ" {
 89.                 local cond2        = "Kids under 14"
 90.                 local cond3        = "No kids under 14"
 91.                 foreach rd in DiD { //ES
 92.                         file open myfile using "../output/tab_`rd'_`data'.
> txt", write replace
 93.                         file write myfile "\begin{threeparttable}" ///
>                                                         _n "\begin{tabular}{l
> |cccc} \hline\hline"  ///
>                                                         _n " & `lab_v1' & `la
> b_v2' & `lab_v3' & `lab_v4' \\ \hline" ///
>                                                         _n " & (1)      & (2)
>       & (3)      & (4)      \\ "  ///
>                                                         _n " & Age: 18-22 & A
> ge: 16-22 & Age: 18-30 & Age: 18-30 \\ \hline" ///
>                                                         _n "Mean (baseline) &
>  " %9.3f (`avg_v1_`rd'_fertile') " & " %9.3f (`avg_v2_`rd'_fertile') ///
>                                                                           " &
>  " %9.3f (`avg_v3_`rd'_fertile') " & " %9.3f (`avg_v4_`rd'_fertile') " \\ \hl
> ine "
 94.                         local r = rowsof(TAB_`rd') / 3
 95.                         forvalues i = 1/`r' {
 96.                                 local j1 = 3 * `i' - 2
 97.                                 local j2 = 3 * `i' - 1
 98.                                 local j3 = 3 * `i' 
 99.                                 file write myfile ///
>                                         _n "`cond`i'' &  " ///
>                                                       %9.3f  (TAB_`rd'[`j1',1
> ]) "  &  " %9.3f (TAB_`rd'[`j1',2]) " & " ///
>                               %9.3f  (TAB_`rd'[`j1',3]) "  &  " %9.3f (TAB_`r
> d'[`j1',4]) " \\ " ///
>                         _n " & (" %9.3f  (TAB_`rd'[`j2',1]) ") & (" %9.3f (TA
> B_`rd'[`j2',2]) ") & (" ///
>                                   %9.3f  (TAB_`rd'[`j2',3]) ") & (" %9.3f (TA
> B_`rd'[`j2',4]) ") \\ " ///
>                         _n " &  " %9.0fc (TAB_`rd'[`j3',1]) "  &  " %9.0fc (T
> AB_`rd'[`j3',2]) " & " ///
>                                       %9.0fc (TAB_`rd'[`j3',3]) "  &  " %9.0f
> c (TAB_`rd'[`j3',4]) " \\ "
100.                         }
101.                         file write myfile _n "\hline\hline" _n "\end{tabul
> ar}" 
102.                         file close myfile
103.                 }       
104.         }
105.     else if "`data'" == "births_ind" {
106.                 local cond2 = "Had previous pregnancy"
107.                 local cond3 = "First pregnancy"
108.                 foreach rd in DiD { //ES
109.                         file open myfile using "../output/tab_`rd'_`data'.
> txt", write replace
110.                         file write myfile "\begin{threeparttable}" ///
>                                                         _n "\begin{tabular}{l
> |cccc} \hline\hline"  ///
>                                                         _n " & `lab1_v1' & `l
> ab1_v2' & `lab1_v3' & `lab1_v4' \\ \hline" ///
>                                                         _n " & (1)       & (2
> )       & (3)       & (4)       \\ \hline" ///
>                                                         _n "Mean (baseline) &
>  " %9.3f (`avg_v1_`rd'_fertile') " & " %9.3f (`avg_v2_`rd'_fertile') ///
>                                                                           " &
>  " %9.3f (`avg_v3_`rd'_fertile') " & " %9.3f (`avg_v4_`rd'_fertile') " \\ \hl
> ine "
111.                         local r = rowsof(TAB_`rd') / 3
112.                         forvalues i = 1/`r' {
113.                                 local j1 = 3 * `i' - 2
114.                                 local j2 = 3 * `i' - 1
115.                                 local j3 = 3 * `i' 
116.                                 file write myfile ///
>                                         _n "`cond`i'' &  " ///
>                                                       %9.3f  (TAB_`rd'[`j1',1
> ]) "  &  " %9.3f (TAB_`rd'[`j1',2]) " & " ///
>                               %9.3f  (TAB_`rd'[`j1',3]) "  &  " %9.3f (TAB_`r
> d'[`j1',4]) " \\ " /// 
>                         _n " & (" %9.3f  (TAB_`rd'[`j2',1]) ") & (" %9.3f (TA
> B_`rd'[`j2',2]) ") & (" ///
>                                   %9.3f  (TAB_`rd'[`j2',3]) ") & (" %9.3f (TA
> B_`rd'[`j2',4]) ") \\ " ///
>                         _n " &  " %9.0fc (TAB_`rd'[`j3',1]) "  &  " %9.0fc (T
> AB_`rd'[`j3',2]) " & " ///
>                                       %9.0fc (TAB_`rd'[`j3',3]) "  &  " %9.0f
> c (TAB_`rd'[`j3',4])  " \\ " 
117.                         }
118.                         file write myfile _n "\hline\hline" _n "\end{tabul
> ar}" 
119.                         file close myfile
120.                 }               
121.         }
122.         else {
123.                 local cond2 = "Had previous pregnancy"
124.                 local cond3 = "First pregnancy"
125.                 foreach rd in DiD { //ES
126.                         file open myfile using "../output/tab_`rd'_`data'.
> txt", write replace
127.                         file write myfile "\begin{threeparttable}" ///
>                                                         _n "\begin{tabular}{l
> |cc} \hline\hline"  ///
>                                                         _n " & `lab_v1' & Fer
> tility rate \\ \hline"  ///
>                                                         _n "Mean & " %9.3f (`
> avg_v1_`rd'_fertile') " & " %9.3f (`avg_v2_`rd'_fertile') " \\ \hline "
128.                         local r = rowsof(TAB_`rd') / 3
129.                                 forvalues i = 1/`r' {
130.                                         local j1 = 3 * `i' - 2
131.                                         local j2 = 3 * `i' - 1
132.                                         local j3 = 3 * `i' 
133.                                         file write myfile ///
>                                                 _n "`cond`i'' &  " %9.3f  (TA
> B_`rd'[`j1',1]) "  &  " %9.3f  (TAB_`rd'[`j1',2]) " \\ " ///
>                                 _n "          & (" %9.3f  (TAB_`rd'[`j2',1]) 
> ") & (" %9.3f  (TAB_`rd'[`j2',2]) ") \\ " ///
>                                 _n "          &  " %9.0fc (TAB_`rd'[`j3',1]) 
> "  &  " %9.0fc (TAB_`rd'[`j3',2]) " \\ "
134.                         }
135.                         file write myfile _n "\hline\hline" _n "\end{tabul
> ar}" 
136.                         file close myfile
137.                 }
138.         }
139.                 
.         /*matrix_to_txt, matrix(TAB_ES) saving("../output/tables.txt") append
>  ///
>                  title(<tab:es_pooled_`data'>)*/
.         matrix_to_txt, matrix(TAB_DiD) saving("../output/tables.txt") append 
> ///
>                  title(<tab:did_pooled_`data'>)
140. end

. 
. main
file ../temp/plots_sample_ech_labor.dta not found
r(601);

end of do-file
r(601);

 make.py ended: 2020-03-07 17:59:19
