
 make.py started: 2018-05-08 15:39:47 C:\Users\cravizza\GitHub\Aborto-Uruguay\analysis\first_stage\code 




Execute:  "C:\Program Files (x86)\Stata15\StataSE-64.exe" /e do "./mortality.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.0   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401506201178
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./mortality.do 

. clear all

. set more off

. 
. program main
  1.         import excel using "..\..\..\raw\Cuadro 7. Mortalidad Materna 1900
> -2015.xlsx", clear cellrange(a9:h125) firstrow
  2.         rename AÃ±o year
  3.         label var year "Year"
  4.         keep if year>=1985
  5.         tsset year
  6.         gen ratio1 = Cifras/Muertesdemujeres
  7. 
.         tssmooth ma ma_muertes = MuertesMaternas, window(2 1 2) //5-year aver
> age
  8.         tssmooth ma ma_razon   = Raz, window(2 1 2) //5-year average
  9.         tssmooth ma ma_ratio1  = ratio1, window(2 1 2)
 10.         label var   ma_ratio1 "Maternal mortality over fertile women's mor
> tality"
 11.         
.         plot_ratio, var_ratio(ma_ratio1) start_yr(2000) end_yr(2014) tline(20
> 03.5 2011.5)
 12. end

. 
. program plot_ratio, 
  1. syntax, var_ratio(string) start_yr(int) end_yr(int) tline(string)
  2.         tsline `var_ratio' if inrange(year,`start_yr',`end_yr') ///
>                 , recast(connected) mc(blue) lc(blue) tlab(`start_yr'(4)`end_
> yr') ///
>                 tline(`tline', lcolor(black) lpattern(dot)) ///
>                 graphregion(fcolor(white) lcolor(white))
  3.         graph export ../output/mortality_`var_ratio'.pdf, replace
  4. end

. 
. main
(85 observations deleted)
        time variable:  year, 1985 to 2015
                delta:  1 unit
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)=
     MuertesMaternas
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= Raz
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= ratio1
(file ../output/mortality_ma_ratio1.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata15\StataSE-64.exe" /e do "./vital_records.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.0   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401506201178
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./vital_records.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main    
  1.         *global y_date_rivera = 2010
.         do ../../globals.do
  2.         
.         foreach var in not_married first_pregnancy age_young high_school reco
> mm_prenatal_numvisits {
  3.                 plot_births, treatment(rivera) by_vars(`var') time(anio_se
> m)
  4.                 plot_births, treatment(rivera) by_vars(`var') time(anio)
  5.         }
  6. 
.         foreach time in anio anio_sem {
  7.                 grc1leg g_`time'_not_marri_0 g_`time'_not_marri_1 g_`time'
> _first_pre_0 ///
>                                 g_`time'_first_pre_1 g_`time'_age_young_0 g_`
> time'_age_young_1 ///
>                         , cols(2) legendfrom(g_`time'_not_marri_0) position(6
> ) ///
>                           graphregion(color(white)) name(g_`time')
  8.                 graph display g_`time', ysiz(18) xsiz(15)
  9.                 graph export "..\output\births_rivera_`time'.pdf", replace
 10.         }
 11. end

. 
. capture program drop plot_births

. program plot_births
  1. syntax, by_vars(string) treatment(string) time(string) 
  2.         
.         use "..\..\..\assign_treatment\output\births.dta", clear
  3. 
.         if "`time'" == "anio_mon" {
  4.         local range "if inrange(`time', tm(${m_date_`treatment'}) - ${m_pr
> e},tm(${m_date_`treatment'}) + ${m_post}) "
  5.         local xtitle "Year-month"
  6.         local vertical = tm(${m_date_`treatment'}) - 0.5    
  7.         local vertical2= tm(${m_date_`treatment'}) - 6.5 
  8.         local y_label = "0(250)500"
  9.     }
 10.         else if "`time'" == "anio_qtr" {
 11.         local range "if inrange(`time', tq(${q_date_`treatment'}) - ${q_pr
> e},tq(${q_date_`treatment'}) + ${q_post}) "
 12.         local xtitle "Year-quarter"
 13.         local vertical = tq(${q_date_`treatment'}) - 0.5 
 14.         local vertical2= tq(${q_date_`treatment'}) + 2.5   
 15.         local y_label = "0(500)1000" 
 16.     }
 17.     else if "`time'" == "anio_sem" {
 18.         local range "if inrange(`time', th(${s_date_`treatment'}) - ${s_pr
> e},th(${s_date_`treatment'}) + ${s_post}) "
 19.         local xtitle "Year-half"
 20.         local vertical = th(${s_date_`treatment'}) - 0.5   
 21.         local vertical2= th(${s_date_`treatment'}) + 1.5 
 22.         local y_label = "0(500)1000"
 23.     }
 24.     else {
 25.         local range "if inrange(`time', ${y_date_`treatment'} - ${y_pre}, 
> ${y_date_`treatment'} + ${y_post}) "
 26.         local xtitle "Year"
 27.         local vertical = ${y_date_`treatment'} - 0.5  
 28.         local vertical2= ${y_date_`treatment'} + 0.5
 29.         local y_label = "0(600)1800"
 30.     }
 31.         
.         collapse (count) births=edadm , by(`time' treatment_`treatment' `by_v
> ars')
 32.         
.         keep if !mi(treatment)
 33.         gen Treatment = births if treatment_`treatment'==1
 34.         gen Control   = births if treatment_`treatment'==0
 35.         
.         /*tw (scatter Treatment `time' `range', connect(l) mc(blue) lc(blue))
>  ///
>            (scatter Control   `time' `range', connect(l) mc(red)  lc(red)) //
> /
>            ,  by(`by_vars', title(${legend_`treatment'}))  ///
>            tline(`vertical' `vertical2', lcolor(black) lpattern(dot)) ///
>            xtitle("`xtitle'") xsize(8) ///
>            scheme(s1color) 
> 
>         graph export "..\output\births_`treatment'_`time'_`by_vars'.pdf", rep
> lace*/
. 
.         local g_name = substr("`by_vars'",1,9)
 36.         local opt1 = `"tline(`vertical' `vertical2', lcolor(black) lpatter
> n(dot)) xsize(6) scheme(s1color) "'
 37.         local opt2 = `"ylabel(`y_label', labs(small)) xlabel(, labs(small)
> ) xtitle("`xtitle'", si(small)) legend(si(small))"'
 38.         forvalues v=0/1 {
 39.                 tw (scatter Treatment `time' `range' & `by_vars'==`v', con
> nect(l) mc(blue) lc(blue) ) ///
>                    (scatter Control   `time' `range' & `by_vars'==`v', connec
> t(l) mc(red)  lc(red)) ///
>                         , `opt1' `opt2' title(`: label `by_vars' `v'', si(med
> ium)) name(g_`time'_`g_name'_`v')
 40.         }
 41. end

. 
. capture program drop diff_in_diff

. program diff_in_diff
  1. syntax, by_vars(string) treatment(string) time(string)
  2.         
.         use "..\..\..\assign_treatment\output\births.dta", clear
  3. 
.         local treatment rivera
  4.         local time anio
  5.         local by_vars first_pregnancy
  6. 
.         if "`time'" == "anio_mon" {
  7.         local range "if inrange(`time', tm(${m_date_`treatment'}) - ${m_pr
> e},tm(${m_date_`treatment'}) + ${m_post}) "
  8.         local event_date         ${m_date_`treatment'}   
  9.         gen post = (`time' >= tm(${m_date_`treatment'})) 
 10.     }
 11.         else if "`time'" == "anio_qtr" {
 12.         local range "if inrange(`time', tq(${q_date_`treatment'}) - ${q_pr
> e},tq(${q_date_`treatment'}) + ${q_post}) "
 13.         local event_date         ${q_date_`treatment'}  
 14.         gen post = (`time' >= tq(${q_date_`treatment'}))  
 15.     }
 16.     else if "`time'" == "anio_sem" {
 17.         local range "if inrange(`time', th(${s_date_`treatment'}) - ${s_pr
> e},th(${s_date_`treatment'}) + ${s_post}) "
 18.         local event_date         ${s_date_`treatment'}  
 19.         gen post = (`time' >= th(${s_date_`treatment'}))   
 20.     }
 21.     else {
 22.         local range "if inrange(`time', ${y_date_`treatment'} - ${y_pre}, 
> ${y_date_`treatment'} + ${y_post}) "
 23.         local event_date ${y_date_`treatment'}  
 24.         gen post = (`time' >=  ${y_date_`treatment'})  
 25.     }
 26.         
.         keep if !mi(treatment_`treatment')
 27.         
.         reg edadm post##treatment_`treatment'
 28. 
.         collapse (count) births=edadm , by(anio treatment_`treatment' first_p
> regnancy not_married) //`by_vars')
 29.                 
.                 gen post = (anio>`event_date')
 30.                 gen interaction = post * treatment_`treatment'
 31.                 gen log_births = log(births)
 32.                 
.                 reg log_births post##treatment_`treatment'##first_pregnancy##
> not_married
 33. end

. 
. main

.     * Dates of treatments
.     global m_date_mvd     "2004m4"

.     global m_date_florida "2008m8"

.     global m_date_rivera  "2010m6"

.     global m_date_salto   "2013m1"

.     
.     global q_date_mvd     "2004q2"

.     global q_date_florida "2008q3"

.     global q_date_rivera  "2010q3"

.     global q_date_salto   "2013q1"

.     
.     global s_date_mvd     "2004h1"

.     global s_date_florida "2008h2"

.     global s_date_rivera  "2010h2"

.     global s_date_salto   "2013h1"

.     
.     global y_date_mvd     2004 

.     global y_date_florida 2008

.     global y_date_rivera  2010 

.     global y_date_salto   2013 

. 
.     * Ranges
.     global m_pre  48

.     global m_post 24

.     global q_pre  16

.     global q_post 12

.     global s_pre  8

.     global s_post 4

.     global y_pre  4

.     global y_post 2

. 
.     * Ranges SCM (to build synth control)
.     global q_scm_pre  30

.     global q_scm_post 16

.     global s_scm_pre  20

.     global s_scm_post 8

.     global y_scm_pre  10

.     global y_scm_post 4

. 
.     *Lag list (related to Ranges SCM)
.     global q_lag_list " 8 9 10 11 12 13 14 15 16" //`" 1 3 5 7 "'

.     global s_lag_list " 8 9 10 11 12 13 14 15 16 17 18 19 20 " //`" 5 6 7 8 9
>  10 11 12 "'

.     global y_lag_list " 2 3 4 5 6 7 " //`" 3 4 5 6 "'

. 
.     * Legends
.     global legend_mvd    = "Montevideo"

.     global legend_rivera = "Rivera"

.     global legend_salto  = "Salto"

.     global legend_florida  = "Florida"

. 
end of do-file
(70 observations deleted)
(68 missing values generated)
(69 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(70 observations deleted)
(68 missing values generated)
(69 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(70 observations deleted)
(68 missing values generated)
(69 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(70 observations deleted)
(68 missing values generated)
(69 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(70 observations deleted)
(68 missing values generated)
(69 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(file ..\output\births_rivera_anio.pdf written in PDF format)
(file ..\output\births_rivera_anio_sem.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata15\StataSE-64.exe" /e do "./state_of_birth.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.0   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401506201178
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./state_of_birth.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
.         use "..\..\..\assign_treatment\output\births.dta", clear

.         drop if inlist(depar,20,99) // drop Extranjero, No indicado
(1,632 observations deleted)

. 
.         collapse (count) births = edadm, by(anio codep depar)

.         egen births_tot = total(births), by(anio depar)

.         gen births_sh = births/births_tot

.         
.         gen tag_same = depar==codep

.         gen tag_mvd  = codep==10

.         gen births_sh_same = births/births_tot if tag_same
(2,122 missing values generated)

.         gen births_sh_mvd  = births/births_tot if tag_mvd
(2,122 missing values generated)

. 
.         collapse (max) births_sh_same births_sh_mvd, by(anio depar)

.         xtset depar anio
       panel variable:  depar (strongly balanced)
        time variable:  anio, 1999 to 2015
                delta:  1 unit

.         label var anio "Birth year"

.         label var births_sh_same "Share of births in same state"

.         label var births_sh_mvd  "Share of births in Montevideo"

.         label var    depar "Mother's residential state"

. 
.         foreach x in same mvd {
  2.                 egen min_sh_`x' = min(births_sh_`x'), by(depar)
  3.                 qui sum min_sh_`x', det
  4.                 gen tag_`x' = (min_sh_`x'> r(p50))
  5.         }

. 
.         local plot_lines  = "plot1(lp(shortdash)) plot2(lp(shortdash)) plot3(
> lp(shortdash)) plot4(lp(shortdash)) plot5(lp(shortdash))"

.         local legend_all  = "legend(cols(7) symx(3) si(vsmall) bex)"

.         local legend_mvd  = "legend(off)"

.         local legend_same = "legend(rows(3) symx(5) si(small))"

.         local legend_mvd  = "legend(off)"

.         foreach x in same mvd {
  2.                 xtline births_sh_`x', ov ylabel(0 (.2) 1 ) name(`x') ///
>                         graphregion(color(white)) `legend_all' `plot_lines'
  3.                 qui sum births_sh_`x'
  4.                 local min_`x' = floor(`r(min)'*5) / 5
  5.                 forvalues tag = 0/1 {
  6.                         xtline births_sh_`x' if tag_`x'==`tag', ov ylabel(
> `min_`x'' (.2) 1 ) name(`x'_`tag') ///
>                                 graphregion(color(white)) `legend_`x''
  7.                 }
  8.         }

.         
.         graph combine mvd_0 mvd_1 same_0 same_1, ysiz(6) xsiz(10) graphregion
> (color(white)) scale(0.8) 

.         graph export "..\output\births_sh_2groups.pdf", replace
(file ..\output\births_sh_2groups.pdf written in PDF format)

. 
.         grc1leg same mvd, rows(1) legendfrom(same) position(6) cols(2) graphr
> egion(color(white))

.         graph export "..\output\births_sh_1group.pdf", replace
(file ..\output\births_sh_1group.pdf written in PDF format)

. 
.         graph drop same_0 same_1 mvd_0 mvd_1 same mvd

. 
. 
end of do-file

 make.py ended: 2018-05-08 15:40:51
