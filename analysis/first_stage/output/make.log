
 make.py started: 2020-03-03 10:21:16 C:\Users\dgentil1\Desktop\aborto_uru_repo\Aborto-Uruguay\analysis\first_stage\code 




Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./mortality.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./mortality.do 

. clear all

. set more off

. 
. program main
  1.     import_brasil_data, file(mortality_w_fertile) geo_var(unidadedafederaç
> ão)
  2.     import_brasil_data, file(maternal_mortality) geo_var(unidadedafederaçã
> o)
  3.     import_brasil_data, file(tot_mortality_w_fertile) geo_var(região)
  4.     import_brasil_data, file(tot_maternal_mortality) geo_var(região)   
  5.     
.     process_brasil_data
  6. 
.     import_and_process_uruguay_data
  7. 
.     use "..\temp\brasil_mm_data.dta", clear
  8.     append using "..\temp\uruguay_mm_data.dta"    
  9.     
.     plot_ratio, var_ratio(ma_mm_ratio) start_yr(1998) ///
>             end_yr(2014) tline(2003.5 2011.5)
 10.     plot_ratio, var_ratio(mm_ratio) start_yr(1996) ///
>             end_yr(2016) tline(2003.5 2011.5)
 11. 
.     gen post = (year > 2003)
 12.         gen treatment = (geo_unit == "Uruguay")
 13.         did_reg, var_ratio(ma_mm_ratio)
 14.         did_reg, var_ratio(mm_ratio)
 15. end

. 
. program import_brasil_data
  1.     syntax, file(str) geo_var(str)
  2.  
.     import delimited "..\..\..\raw\\`file'.csv", clear ///
>             delimiter (";", collapse) varname(1)
  3.     
.     drop if missing(v2)
  4.     
.     rename `geo_var' geo_unit
  5.     
.     forval i = 2/22 {
  6.         local year = 1994 + `i'
  7.         local name  "`file'`year'"
  8.         rename v`i' `name' 
  9.     }
 10.     
.     reshape long `file', i(geo_unit) j(year)
 11.     
.     drop total
 12.     
.     save "..\temp\\`file'.dta", replace
 13.  end

.  
. program process_brasil_data
  1.     use "..\temp\mortality_w_fertile.dta", clear
  2.     merge 1:1 year geo_unit using "../temp/maternal_mortality.dta", ///
>         assert(3) keep(3) nogen 
  3.     replace geo_unit = "Rio Grande do Sul" if geo_unit == "43 Rio Grande d
> o Sul"
  4. 
.     keep if geo_unit == "Rio Grande do Sul"
  5.     gen mm_ratio = maternal_mortality / mortality_w_fertile
  6.     save "..\temp\rgds_mm_ratio.dta", replace
  7.    
.     use "..\temp\tot_mortality_w_fertile.dta", clear
  8.     merge 1:1 geo_unit year using "..\temp\tot_maternal_mortality.dta", //
> /
>         assert(3) keep(3) nogen 
  9.     keep if geo_unit == "Total"
 10.     replace geo_unit = "Brasil" if geo_unit == "Total"
 11.     rename (tot_mortality_w_fertile tot_maternal_mortality) ///
>         (mortality_w_fertile maternal_mortality)
 12.     gen mm_ratio = maternal_mortality / mortality_w_fertile
 13. 
.     append using "..\temp\rgds_mm_ratio.dta"
 14.         
.         encode geo_unit, gen(geo_unit_num)
 15. 
.     xtset geo_unit_num year
 16. 
.     tssmooth ma ma_mm_ratio  = mm_ratio, window(2 1 2)
 17.     label var   ma_mm_ratio "Maternal mortality over fertile women's morta
> lity"
 18.     
.     save "..\temp\brasil_mm_data.dta", replace
 19. end

. 
. program import_and_process_uruguay_data
  1.     import excel using "..\..\..\raw\Cuadro 7. Mortalidad Materna 1900-201
> 5.xlsx", clear cellrange(a9:h125) firstrow
  2.     rename Año year
  3.     label var year "Year"
  4.     keep if year>=1985
  5.     gen geo_unit = "Uruguay"
  6.         
.     gen mm_ratio = Cifras/Muertesdemujeres
  7. 
.     tsset year
  8. 
.     tssmooth ma ma_muertes = MuertesMaternas, window(2 1 2) //5-year average
  9.     tssmooth ma ma_razon   = Raz, window(2 1 2) //5-year average
 10.     tssmooth ma ma_mm_ratio  = mm_ratio, window(2 1 2)
 11.     label var   ma_mm_ratio "Maternal mortality over fertile women's morta
> lity"
 12. 
.     save "..\temp\uruguay_mm_data.dta", replace
 13. end

. 
. program plot_ratio, 
  1.     syntax, var_ratio(string) start_yr(int) end_yr(int) tline(string)
  2. 
.     twoway (connected `var_ratio' year if inrange(year,`start_yr',`end_yr') &
>  geo_unit == "Brasil", ///
>             yaxis(1) ylabel(0.012(0.01)0.032, axis(1)) mc(navy) lc(navy) lp(d
> ash)) ///
>         (connected `var_ratio' year if inrange(year,`start_yr',`end_yr') & ge
> o_unit == "Uruguay", ///
>                 yaxis(2) ylabel(0.002(0.01)0.022, axis(2)) mc(maroon) lc(maro
> on) lp(solid)), ///
>                 tlab(`start_yr'(4)`end_yr') xtitle("Year") ///
>         xline(`tline', lcolor(black) lpattern(dot)) ///
>                 text(0.0325 2003.5 "IS start") ///
>                 text(0.0325 2011.5 "VTP law") ///
>         graphregion(fcolor(white) lcolor(white)) ///
>                 legend(label(1 "Brazil") label(2 "Uruguay") cols(3)) ///
>                 l1title("Maternal mortality over fertile women's deaths, Braz
> il", size(medsmall)) ///
>         r1title("Maternal mortality over fertile women's deaths, Uruguay", si
> ze(medsmall)) ///
>                 ytitle("", axis(1)) ytitle("", axis(2))
  3.     graph export ../output/mortality_`var_ratio'.pdf, replace
  4. end

. 
. program did_reg
  1.     syntax, var_ratio(str)
  2.         qui sum `var_ratio' if (geo_unit == "Uruguay" | geo_unit == "Brasi
> l"), meanonly
  3.     local avg_`var_ratio' = r(mean)
  4.         
.         reg `var_ratio' post##treatment if ///
>             (geo_unit == "Uruguay" | geo_unit == "Brasil")
  5.                 
.         file open myfile using "../output/tab_`var_ratio'.txt", write replace
  6.     file write myfile "\begin{threeparttable}" ///
>                     _n "\begin{tabular}{l|c} \hline\hline"  ///
>                     _n " & Maternal mortality ratio \\ \hline"  ///
>                     _n "Mean & " %9.3f (`avg_`var_ratio'') " \\ \hline " ///
>                     _n "Coefficient  &  " %9.3f ( _b[1.post#1.treatment]) "  
> \\ " ///
>                     _n "Std. error   & (" %9.3f (_se[1.post#1.treatment]) ") 
> \\ " ///
>                     _n "Observations &  " %9.0fc (`e(N)')                 "  
> \\ " ///
>                     _n "\hline\hline" _n "\end{tabular}" 
  7.     file close myfile   
  8. end

. 
. main
(23 vars, 3 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      42
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
mortality_w_fertile1996 mortality_w_fertile1997 ... mortality_w_fertile2016->mo
> rtality_w_fertile
-----------------------------------------------------------------------------
(note: file ..\temp\mortality_w_fertile.dta not found)
file ..\temp\mortality_w_fertile.dta saved
(23 vars, 3 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      42
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
maternal_mortality1996 maternal_mortality1997 ... maternal_mortality2016->mater
> nal_mortality
-----------------------------------------------------------------------------
(note: file ..\temp\maternal_mortality.dta not found)
file ..\temp\maternal_mortality.dta saved
(23 vars, 7 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        6   ->     126
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
tot_mortality_w_fertile1996 tot_mortality_w_fertile1997 ... tot_mortality_w_fer
> tile2016->tot_mortality_w_fertile
-----------------------------------------------------------------------------
(note: file ..\temp\tot_mortality_w_fertile.dta not found)
file ..\temp\tot_mortality_w_fertile.dta saved
(23 vars, 7 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        6   ->     126
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
tot_maternal_mortality1996 tot_maternal_mortality1997 ... tot_maternal_mortalit
> y2016->tot_maternal_mortality
-----------------------------------------------------------------------------
(note: file ..\temp\tot_maternal_mortality.dta not found)
file ..\temp\tot_maternal_mortality.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                42  
    -----------------------------------------
(21 real changes made)
(21 observations deleted)
(note: file ..\temp\rgds_mm_ratio.dta not found)
file ..\temp\rgds_mm_ratio.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               126  
    -----------------------------------------
(105 observations deleted)
(21 real changes made)
       panel variable:  geo_unit_num (strongly balanced)
        time variable:  year, 1996 to 2016
                delta:  1 unit
The smoother applied was
     by geo_unit_num : (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)];
     x(t)= mm_ratio
(note: file ..\temp\brasil_mm_data.dta not found)
file ..\temp\brasil_mm_data.dta saved
(85 observations deleted)
        time variable:  year, 1985 to 2015
                delta:  1 unit
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)=
     MuertesMaternas
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= Raz
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= mm_ratio
(note: file ..\temp\uruguay_mm_data.dta not found)
file ..\temp\uruguay_mm_data.dta saved
(file ../output/mortality_ma_mm_ratio.pdf written in PDF format)
(file ../output/mortality_mm_ratio.pdf written in PDF format)

      Source |       SS           df       MS      Number of obs   =        52
-------------+----------------------------------   F(3, 48)        =    265.45
       Model |  .002045918         3  .000681973   Prob > F        =    0.0000
    Residual |  .000123319        48  2.5692e-06   R-squared       =    0.9432
-------------+----------------------------------   Adj R-squared   =    0.9396
       Total |  .002169237        51  .000042534   Root MSE        =     .0016

------------------------------------------------------------------------------
 ma_mm_ratio |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.post |  -.0015487   .0007203    -2.15   0.037    -.0029968   -.0001005
 1.treatment |  -.0110347   .0006755   -16.33   0.000     -.012393   -.0096764
             |
        post#|
   treatment |
        1 1  |  -.0036801   .0009317    -3.95   0.000    -.0055535   -.0018068
             |
       _cons |    .027051   .0005667    47.73   0.000     .0259116    .0281904
------------------------------------------------------------------------------
(note: file ../output/tab_ma_mm_ratio.txt not found)

      Source |       SS           df       MS      Number of obs   =        52
-------------+----------------------------------   F(3, 48)        =     44.89
       Model |  .002022188         3  .000674063   Prob > F        =    0.0000
    Residual |  .000720793        48  .000015017   R-squared       =    0.7372
-------------+----------------------------------   Adj R-squared   =    0.7208
       Total |  .002742981        51  .000053784   Root MSE        =    .00388

------------------------------------------------------------------------------
    mm_ratio |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.post |  -.0013097   .0017413    -0.75   0.456    -.0048108    .0021915
 1.treatment |  -.0105274   .0016332    -6.45   0.000    -.0138112   -.0072436
             |
        post#|
   treatment |
        1 1  |  -.0043652   .0022525    -1.94   0.059    -.0088942    .0001638
             |
       _cons |   .0268114   .0013701    19.57   0.000     .0240568    .0295661
------------------------------------------------------------------------------
(note: file ../output/tab_mm_ratio.txt not found)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./vital_records.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./vital_records.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata14\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata14\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main    
  1.     use "..\..\..\derived\Vitals\output\births_treated_control.dta", clear
  2.     collapse (count) nbr_births = birth_id, by(rel_t_anio treated)
  3.         drop if (rel_t_anio == 0 | rel_t_anio == 1000)
  4.         save ../temp/average_births_rel.dta, replace
  5.         plot_yearly_average, var(nbr_births) ytitle(Number of births)
  6.         graph export ../output/births_rel.pdf, replace
  7.         
.     use "..\..\..\derived\Vitals\output\births_mvd.dta", clear
  8.         keep if public_health == 1
  9.     collapse (count) nbr_births = birth_id, by(rel_t_anio pereira)
 10.         drop if (rel_t_anio == 0 | rel_t_anio == 1000)
 11.         rename pereira treated
 12.         save ../temp/average_births_rel_mvd.dta, replace
 13.         plot_yearly_average, var(nbr_births) ytitle(Number of births)   
 14.         graph export ../output/births_rel_mvd.pdf, replace
 15.                 
.     use ../temp/average_births_rel.dta, clear
 16.         append using ../temp/average_births_rel_mvd.dta
 17.         collapse (sum) nbr_births, by(rel_t_anio treated)
 18.         plot_yearly_average, var(nbr_births) ytitle(Number of births)
 19.         graph export ../output/births_rel_all.pdf, replace      
 20. end

. 
. program plot_yearly_average
  1.     syntax, var(str) ytitle(str)
  2.     
.         sum `var' if treated == 0 & rel_t_anio < 5
  3.         local pre_mean_control = r(mean)
  4.         gen pre_mean_control = `pre_mean_control'
  5.         
.         sum `var' if treated == 0 & rel_t_anio >= 5
  6.         local post_mean_control = r(mean)
  7.         gen post_mean_control = `post_mean_control'
  8.         
.         sum `var' if treated == 1 & rel_t_anio < 5
  9.         local pre_mean_treated = r(mean)
 10.         gen pre_mean_treated = `pre_mean_treated'
 11.         
.         sum `var' if treated == 1 & rel_t_anio >= 5
 12.         local post_mean_treated = r(mean)
 13.         gen post_mean_treated = `post_mean_treated'
 14.         
.     twoway (scatter `var' rel_t_anio if treated == 0, lcol(navy)) ///
>             (line pre_mean_control rel_t_anio if rel_t_anio <= 5, lcol(navy))
>  ///
>             (line post_mean_control rel_t_anio if rel_t_anio >= 5, lcol(navy)
> ) ///
>             (scatter `var' rel_t_anio if treated == 1, col(maroon)) ///
>             (line pre_mean_treated rel_t_anio if rel_t_anio <= 5, lcol(maroon
> )) ///
>             (line post_mean_treated rel_t_anio if rel_t_anio >= 5, lcol(maroo
> n)), ///
>                 legend(order(2 "Control" 5 "Treated")) ///
>                 graphregion(fcolor(white) lcolor(white)) ///
>                 ytitle(`ytitle') ///
>                 xtitle("Years relative to IS") ///
>                 xlabel(1 "-4" 5 "0" 9 "4") xline(5, lcol(grey) lpat(dot))
 15. end 

. 
. main
(4 observations deleted)
(note: file ../temp/average_births_rel.dta not found)
file ../temp/average_births_rel.dta saved

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4     3371.25    93.61045       3269       3496

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5        3336    90.44612       3223       3462

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4      6444.5    195.4985       6224       6652

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5      5918.6    140.1385       5723       6119
(note:  named style grey not found in class color, default attributes used)
(file ../output/births_rel.pdf written in PDF format)
(273,525 observations deleted)
(4 observations deleted)
(note: file ../temp/average_births_rel_mvd.dta not found)
file ../temp/average_births_rel_mvd.dta saved

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4     1113.25    127.4529       1012       1285

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5       974.4    530.5924         50       1348

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4        8220    310.1548       7899       8567

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5      7193.2    311.9458       6917       7691
(note:  named style grey not found in class color, default attributes used)
(file ../output/births_rel_mvd.pdf written in PDF format)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4      4484.5    181.9936       4290       4648

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5      4310.4    502.2612       3423       4632

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          4     14664.5     323.495      14371      15125

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  nbr_births |          5     13111.8    287.7607      12887      13616
(note:  named style grey not found in class color, default attributes used)
(file ../output/births_rel_all.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./state_of_birth.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./state_of_birth.do 

. clear all

. set more off

. adopath + ..\..\..\library\stata\gslab_misc\ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata14\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata14\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "..\..\..\library\stata\gslab_misc\ado"

. 
. program main
  1.         use "..\..\..\derived\Vitals\output\births.dta", clear
  2. 
.         gen_and_label
  3.         build_plots
  4. end

. 
. program gen_and_label
  1.     collapse (count) births = edadm, by(anio dpto dpto_residence)
  2.         egen births_tot = total(births), by(anio dpto_residence)
  3.         gen births_sh = births/births_tot
  4.         
.         gen tag_same = dpto_residence==dpto
  5.         gen tag_mvd  = dpto==1
  6.         gen births_sh_same = births/births_tot if tag_same
  7.         gen births_sh_mvd  = births/births_tot if tag_mvd
  8. 
.         collapse (max) births_sh_same births_sh_mvd, by(anio dpto_residence)
  9.         xtset dpto_residence anio
 10.         label var anio "Birth year"
 11.         label var births_sh_same "Share of births in same state"
 12.         label var births_sh_mvd  "Share of births in Montevideo"
 13.         label var dpto_residence "Mother's residential state"
 14. end 

. 
. program build_plots
  1.         foreach x in same mvd {
  2.                 egen min_sh_`x' = min(births_sh_`x'), by(dpto_residence)
  3.                 qui sum min_sh_`x', det
  4.                 gen tag_`x' = (min_sh_`x'> r(p50))
  5.         }
  6. 
.         local plot_lines  = "plot1(lp(shortdash)) plot2(lp(shortdash)) plot3(
> lp(shortdash)) plot4(lp(shortdash)) plot5(lp(shortdash))"
  7.         local legend_all  = "legend(cols(7) symx(3) si(vsmall) bex)"
  8.         local legend_mvd  = "legend(off)"
  9.         local legend_same = "legend(rows(3) symx(5) si(small))"
 10.         local legend_mvd  = "legend(off)"
 11.         foreach x in same mvd {
 12.                 xtline births_sh_`x', ov ylabel(0 (.2) 1 ) name(`x') ///
>                         graphregion(color(white)) `legend_all' `plot_lines'
 13.                 qui sum births_sh_`x'
 14.                 local min_`x' = floor(`r(min)'*5) / 5
 15.                 forvalues tag = 0/1 {
 16.                         xtline births_sh_`x' if tag_`x'==`tag', ov ylabel(
> `min_`x'' (.2) 1 ) name(`x'_`tag') ///
>                                 graphregion(color(white)) `legend_`x''
 17.                 }
 18.         }
 19.         
.         graph combine mvd_0 mvd_1 same_0 same_1, ysiz(6) xsiz(10) graphregion
> (color(white)) scale(0.8) 
 20.         graph export "..\output\births_sh_2groups.pdf", replace
 21. 
.         grc1leg same mvd, rows(1) legendfrom(same) position(6) cols(2) graphr
> egion(color(white))
 22.         graph export "..\output\births_sh_1group.pdf", replace
 23. 
.         graph drop same_0 same_1 mvd_0 mvd_1 same mvd
 24. end

. 
. * EXECUTE
. main
(2,277 missing values generated)
(2,260 missing values generated)
       panel variable:  dpto_residence (weakly balanced)
        time variable:  anio, 1999 to 2015
                delta:  1 unit
(17 missing values generated)
(file ..\output\births_sh_2groups.pdf written in PDF format)
(file ..\output\births_sh_1group.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./aggregate_births.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./aggregate_births.do 

. clear all

. set more off

. 
. program main
  1.     clean_data
  2.     plot_natality, rescale(1000)
  3. end

. 
. program clean_data
  1.         import excel using "..\..\..\raw\Cuadro 5. Tasas Brutas de Mortali
> dad y Natalidad. Uruguay, 1996-2015.xlsx" ///
>                   , clear cellrange(a39:bi62)
  2. 
.         local i = 0
  3.         foreach x of varlist * {
  4.            rename `x' var`i'
  5.            local i = `i' + 1
  6.         }
  7. 
.         rename var0 dpto
  8. 
.         local j1 = 2
  9.         forvalues year = 1996/2015 {
 10.                 local j0 = `j1' - 1
 11.                 local j2 = `j1' + 1
 12.                 replace var`j1' = "`year'" if mi(var`j1') in 1
 13.                 replace var`j2' = "`year'" if mi(var`j2') in 1
 14.                 assert var`j0'[1] == var`j1'[1] & var`j1'[1] == var`j2'[1]
 15.                 rename var`j0' nat_level`year'
 16.                 rename var`j1' population`year'
 17.                 rename var`j2' nat_rate`year'
 18.                 local j1 = `j1' + 3
 19.         }
 20. 
.         drop in 22/23
 21.         drop in 1/2 
 22. 
.         destring , replace
 23.         local nn=_N+1
 24.         set obs `nn'
 25.         replace dpto = "Montevideo, Canelones y San Jose" in `nn'
 26.         forvalues year = 1996/2015 {
 27.                 replace nat_level`year' = nat_level`year'[2] + nat_level`y
> ear'[10] + nat_level`year'[16] in `nn'
 28.                 replace population`year' = population`year'[2] + populatio
> n`year'[10] + population`year'[16] in `nn'
 29.         }
 30. 
.         foreach var in nat_level nat_rate population {
 31.                 preserve 
 32.                         keep    dpto `var'*
 33.                         reshape long `var', i(dpto) j(year)
 34.                         tempfile     `var'
 35.                         save        ``var''
 36.                 restore
 37.         }
 38.         
.         use `nat_level', clear
 39.         merge 1:1 dpto year using `nat_rate'  , nogen assert(3)
 40.         merge 1:1 dpto year using `population', nogen assert(3)
 41. 
.         encode dpto, g(dpto_num)
 42.         xtset  dpto_num year
 43.         replace nat_rate = nat_level/population*1000
 44. end

. 
. program plot_natality
  1. syntax, rescale(int)
  2.         gen nat_level_`rescale'= nat_level/`rescale'
  3.         label var nat_level_`rescale' "Births (`rescale's)"
  4.         local opts = "overlay graphregion(fcolor(white) lcolor(white)) yla
> b(#3) legend(rows(1))"
  5.         local opt1 = "plot1(recast(con) lc(blue) mc(blue)) "
  6.     local opt2 = "plot1(recast(con) lc(red) mc(red)) "
  7. 
.         xtline nat_level_`rescale' if (dpto=="Montevideo") & inrange(year,200
> 0,2009) ///
>                 , `opts' `opt1' tline(2004, lcolor(black) lpattern(dot)) name
> (mvd, replace) ///
>                 subtitle("Montevideo")
  8.         xtline nat_level_`rescale' if (dpto=="Canelones") & inrange(year,2
> 000,2009) ///
>                 , `opts' `opt1' tline(2004, lcolor(black) lpattern(dot)) name
> (can, replace) ///
>                 subtitle("Canelones")   
  9.         xtline nat_level_`rescale' if (dpto=="San Jose") & inrange(year,20
> 00,2009) ///
>                 , `opts' `opt1' tline(2004, lcolor(black) lpattern(dot)) name
> (san, replace) ///
>                 subtitle("San Jose")    
 10.         xtline nat_level_`rescale' if (dpto=="Florida") & inrange(year,200
> 4,2011) ///
>                 , `opts' `opt1' tline(2008, lcolor(black) lpattern(dot)) name
> (flo, replace) ///
>                 subtitle("Florida")
 11.         xtline nat_level_`rescale' if (dpto=="Rivera") & inrange(year,2006
> ,2013) ///
>                 , `opts' `opt1' tline(2010, lcolor(black) lpattern(dot)) name
> (riv, replace) ///
>                 subtitle("Rivera")
 12.         xtline nat_level_`rescale' if (dpto=="Salto") & inrange(year,2008,
> 2015) ///
>                 , `opts' `opt2' tline(2012, lcolor(black) lpattern(dot)) name
> (sal, replace) ///
>                 subtitle("Salto")
 13.                 
.         graph combine mvd can san flo riv sal, cols(3) ysize(7) xsize(10) gra
> phregion(fcolor(white))
 14.         graph export ../output/natality_`rescale'.pdf, replace
 15.         graph drop _all
 16. end

. 
. main
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(2 observations deleted)
(2 observations deleted)
dpto: contains nonnumeric characters; no replace
nat_level1996: all characters numeric; replaced as long
population1996: all characters numeric; replaced as double
nat_rate1996: all characters numeric; replaced as double
nat_level1997: all characters numeric; replaced as long
population1997: all characters numeric; replaced as double
nat_rate1997: all characters numeric; replaced as double
nat_level1998: all characters numeric; replaced as long
population1998: all characters numeric; replaced as double
nat_rate1998: all characters numeric; replaced as double
nat_level1999: all characters numeric; replaced as long
population1999: all characters numeric; replaced as double
nat_rate1999: all characters numeric; replaced as double
nat_level2000: all characters numeric; replaced as long
population2000: all characters numeric; replaced as double
nat_rate2000: all characters numeric; replaced as double
nat_level2001: all characters numeric; replaced as long
population2001: all characters numeric; replaced as double
nat_rate2001: all characters numeric; replaced as double
nat_level2002: all characters numeric; replaced as long
population2002: all characters numeric; replaced as double
nat_rate2002: all characters numeric; replaced as double
nat_level2003: all characters numeric; replaced as long
population2003: all characters numeric; replaced as double
nat_rate2003: all characters numeric; replaced as double
nat_level2004: all characters numeric; replaced as long
population2004: all characters numeric; replaced as double
nat_rate2004: all characters numeric; replaced as double
nat_level2005: all characters numeric; replaced as long
population2005: all characters numeric; replaced as double
nat_rate2005: all characters numeric; replaced as double
nat_level2006: all characters numeric; replaced as long
population2006: all characters numeric; replaced as double
nat_rate2006: all characters numeric; replaced as double
nat_level2007: all characters numeric; replaced as long
population2007: all characters numeric; replaced as double
nat_rate2007: all characters numeric; replaced as double
nat_level2008: all characters numeric; replaced as long
population2008: all characters numeric; replaced as double
nat_rate2008: all characters numeric; replaced as double
nat_level2009: all characters numeric; replaced as long
population2009: all characters numeric; replaced as double
nat_rate2009: all characters numeric; replaced as double
nat_level2010: all characters numeric; replaced as long
population2010: all characters numeric; replaced as double
nat_rate2010: all characters numeric; replaced as double
nat_level2011: all characters numeric; replaced as long
population2011: all characters numeric; replaced as double
nat_rate2011: all characters numeric; replaced as double
nat_level2012: all characters numeric; replaced as long
population2012: all characters numeric; replaced as double
nat_rate2012: all characters numeric; replaced as double
nat_level2013: all characters numeric; replaced as long
population2013: all characters numeric; replaced as double
nat_rate2013: all characters numeric; replaced as double
nat_level2014: all characters numeric; replaced as long
population2014: all characters numeric; replaced as double
nat_rate2014: all characters numeric; replaced as double
nat_level2015: all characters numeric; replaced as long
population2015: all characters numeric; replaced as double
nat_rate2015: all characters numeric; replaced as double
number of observations (_N) was 20, now 21
variable dpto was str26 now str32
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
nat_level1996 nat_level1997 ... nat_level2015->nat_level
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000002.tmp saved
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
nat_rate1996 nat_rate1997 ... nat_rate2015->   nat_rate
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000004.tmp saved
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
population1996 population1997 ... population2015->population
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000006.tmp saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               420  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               420  
    -----------------------------------------
       panel variable:  dpto_num (strongly balanced)
        time variable:  year, 1996 to 2015
                delta:  1 unit
(418 real changes made)
(file ../output/natality_1000.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./misoprostol.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./misoprostol.do 

. clear all

. set more off

. 
. program main
  1.     use ../../../base/Misoprostol/output/misoprostol.dta, clear
  2.     build_figure
  3. end

. 
. program build_figure
  1. 
.     generate order = 1 if region =="Global"
  2.     replace order = 2 if region =="Latin America"
  3.     replace order = 3 if region =="Chile"
  4.     replace order = 4 if region =="Uruguay"
  5. 
.     graph bar norm_sales, over(year) ///
>         over(region, sort(order) descending) ///
>         asyvars graphregion(fcolor(white) lcolor(white)) ///
>         ytitle("Misoprostol annual sales (base 2002)")
  6.         
.     graph export ../output/misoprostol_sales_2002_2007.pdf, replace
  7.     
.     graph twoway connected ug_per_pop year if region == "Global" || ///
>         connected ug_per_pop year if region == "Latin America" || ///
>         connected ug_per_pop year if region == "Uruguay" || ///
>         connected ug_per_pop year if region == "Chile", ///
>         legend(label(1 "Global") label(2 "Latin America") label(3 "Uruguay") 
> label(4 "Chile")) ///
>         xlabel(2002(5)2007) graphregion(fcolor(white) lcolor(white)) ///
>         xline(2003.5, lcolor(black) lpattern(dot)) text(8.3 2003.5 "IS start"
> ) ///
>         ytitle("Misoprostol (in µg × 10^6) / Population (in millions)", size(
> small))
  8. 
.     graph export ../output/misoprostol_per_capita_2002_2007.pdf, replace
  9. end

. 
. main
(6 missing values generated)
(2 real changes made)
(2 real changes made)
(2 real changes made)
(file ../output/misoprostol_sales_2002_2007.pdf written in PDF format)
(file ../output/misoprostol_per_capita_2002_2007.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./google_trends.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./google_trends.do 

. clear all

. set more off

. 
. program main
  1.         foreach c in uruguay brazil {
  2.                 foreach t in abortion misoprostol {
  3.                         import delimited using "..\..\..\raw\google_trends
> _`t'_`c'.csv", clear ///
>                                  rowrange(4:180) colrange(1:2) varnames(3)   
  4.                         gen date = monthly(month,"YM")
  5.                         format %tm date
  6.                         label var date "Month"
  7.                         drop month
  8.                         capture replace `t'`c' = "1" if `t'`c'=="<1"
  9.                         destring `t'`c', replace
 10.                         tempfile `t'_`c'
 11.                         save ``t'_`c''
 12.                 }
 13.         }
 14.         merge 1:1 date using `misoprostol_uruguay', assert(3) nogen
 15.         merge 1:1 date using    `abortion_uruguay', assert(3) nogen
 16.         merge 1:1 date using    `abortion_brazil' , assert(3) nogen
 17. 
.         local opts = "tline(2004m04 2005m04 2006m04 2007m10 2008m04 2008m11 2
> 012m09 2013m06, lc(black) lp(dot)) " ///
>                            + "tlabel(2004m01(36)2013m01) ttick(#10) lc(blue r
> ed) lp(solid dash) " ///
>                            + "graphregion(fc(white) lc(white))"
 18.         
.         tw line abortionuruguay abortionbrazil date if date<ym(2013,12), `opt
> s' ///
>                 tmlab(2004m04 "(a)" 2005m04 "(b)" 2006m04 "(c)" 2007m10 "(d)"
>  2008m04 "(e)" ///
>                 2008m11 "(f)" 2012m09 "(g)" 2013m06 "(h)", tp(inside) labs(*0
> .9) labgap(*.3)) 
 19.         graph export ../output/google_trends_abortion.pdf, replace
 20.         
.         tw line misoprostoluruguay misoprostolbrazil date if date<ym(2013,12)
> , `opts' ///
>                 tmlab(2004m04 "(a)" 2005m04 "(b)" 2006m04 "(c)" 2007m10 "(d)"
>  2008m04 "(e)" ///
>                 2008m11 "(f)" 2012m09 "(g)" 2013m06 "(h)", tp(inside) labs(*0
> .9) labgap(*.3))
 21.         graph export ../output/google_trends_misoprostol.pdf, replace
 22. end

. 
. main
(2 vars, 177 obs)
abortionuruguay already numeric; no replace
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000001.tmp saved
(2 vars, 177 obs)
misoprostoluruguay already numeric; no replace
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000002.tmp saved
(2 vars, 177 obs)
abortionbrazil already numeric; no replace
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000003.tmp saved
(2 vars, 177 obs)
misoprostolbrazil already numeric; no replace
file C:\Users\dgentil1\AppData\Local\Temp\ST_00000004.tmp saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               177  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               177  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               177  
    -----------------------------------------
(file ../output/google_trends_abortion.pdf written in PDF format)
(file ../output/google_trends_misoprostol.pdf written in PDF format)

. 
end of do-file

 make.py ended: 2020-03-03 10:21:48
