
 make.py started: 2018-09-24 23:48:33 C:\Users\dgentil1\Desktop\aborto_uru_repo\Aborto-Uruguay\analysis\first_stage\code 




Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./mortality.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./mortality.do 

. clear all

. set more off

. 
. program main
  1.     import_brasil_data, file(mortality_w_fertile) geo_var(unidadedafederaç
> ão)
  2.     import_brasil_data, file(maternal_mortality) geo_var(unidadedafederaçã
> o)
  3.     import_brasil_data, file(tot_mortality_w_fertile) geo_var(região)
  4.     import_brasil_data, file(tot_maternal_mortality) geo_var(região)   
  5.     
.     process_brasil_data
  6. 
.     import_and_process_uruguay_data
  7. 
.     use "..\temp\brasil_mm_data.dta", clear
  8.     append using "..\temp\uruguay_mm_data.dta"    
  9.     
.     plot_ratio, var_ratio(ma_mm_ratio) start_yr(1998) ///
>             end_yr(2014) tline(2003.5 2011.5)
 10.     plot_ratio, var_ratio(mm_ratio) start_yr(1996) ///
>             end_yr(2016) tline(2003.5 2011.5)
 11. 
.     gen post = (year > 2003)
 12.         gen treatment = (geo_unit == "Uruguay")
 13.         did_reg, var_ratio(ma_mm_ratio)
 14.         did_reg, var_ratio(mm_ratio)
 15. end

. 
. program import_brasil_data
  1.     syntax, file(str) geo_var(str)
  2.  
.     import delimited "..\..\..\raw\\`file'.csv", clear ///
>             delimiter (";", collapse) varname(1)
  3.     
.     drop if missing(v2)
  4.     
.     rename `geo_var' geo_unit
  5.     
.     forval i = 2/22 {
  6.         local year = 1994 + `i'
  7.         local name  "`file'`year'"
  8.         rename v`i' `name' 
  9.     }
 10.     
.     reshape long `file', i(geo_unit) j(year)
 11.     
.     drop total
 12.     
.     save "..\temp\\`file'.dta", replace
 13.  end

.  
. program process_brasil_data
  1.     use "..\temp\mortality_w_fertile.dta", clear
  2.     merge 1:1 year geo_unit using "../temp/maternal_mortality.dta", ///
>         assert(3) keep(3) nogen 
  3.     replace geo_unit = "Rio Grande do Sul" if geo_unit == "43 Rio Grande d
> o Sul"
  4. 
.     keep if geo_unit == "Rio Grande do Sul"
  5.     gen mm_ratio = maternal_mortality / mortality_w_fertile
  6.     save "..\temp\rgds_mm_ratio.dta", replace
  7.    
.     use "..\temp\tot_mortality_w_fertile.dta", clear
  8.     merge 1:1 geo_unit year using "..\temp\tot_maternal_mortality.dta", //
> /
>         assert(3) keep(3) nogen 
  9.     keep if geo_unit == "Total"
 10.     replace geo_unit = "Brasil" if geo_unit == "Total"
 11.     rename (tot_mortality_w_fertile tot_maternal_mortality) ///
>         (mortality_w_fertile maternal_mortality)
 12.     gen mm_ratio = maternal_mortality / mortality_w_fertile
 13. 
.     append using "..\temp\rgds_mm_ratio.dta"
 14.         
.         encode geo_unit, gen(geo_unit_num)
 15. 
.     xtset geo_unit_num year
 16. 
.     tssmooth ma ma_mm_ratio  = mm_ratio, window(2 1 2)
 17.     label var   ma_mm_ratio "Maternal mortality over fertile women's morta
> lity"
 18.     
.     save "..\temp\brasil_mm_data.dta", replace
 19. end

. 
. program import_and_process_uruguay_data
  1.     import excel using "..\..\..\raw\Cuadro 7. Mortalidad Materna 1900-201
> 5.xlsx", clear cellrange(a9:h125) firstrow
  2.     rename Año year
  3.     label var year "Year"
  4.     keep if year>=1985
  5.     gen geo_unit = "Uruguay"
  6.         
.     gen mm_ratio = Cifras/Muertesdemujeres
  7. 
.     tsset year
  8. 
.     tssmooth ma ma_muertes = MuertesMaternas, window(2 1 2) //5-year average
  9.     tssmooth ma ma_razon   = Raz, window(2 1 2) //5-year average
 10.     tssmooth ma ma_mm_ratio  = mm_ratio, window(2 1 2)
 11.     label var   ma_mm_ratio "Maternal mortality over fertile women's morta
> lity"
 12. 
.     save "..\temp\uruguay_mm_data.dta", replace
 13. end

. 
. program plot_ratio, 
  1.     syntax, var_ratio(string) start_yr(int) end_yr(int) tline(string)
  2. 
.     twoway (connected `var_ratio' year if inrange(year,`start_yr',`end_yr') &
>  ///
>             geo_unit == "Brasil") ///
>         (connected `var_ratio' year if inrange(year,`start_yr',`end_yr') & //
> /
>                 geo_unit == "Uruguay"), ///
>                 tlab(`start_yr'(4)`end_yr') ///
>         xline(`tline', lcolor(black) lpattern(dot)) ///
>         graphregion(fcolor(white) lcolor(white)) ///
>                 legend(label(1 "Brasil") label(2 "Uruguay") cols(3))
  3.     graph export ../output/mortality_`var_ratio'.pdf, replace
  4. end

. 
. program did_reg
  1.     syntax, var_ratio(str)
  2.         reg `var_ratio' post##treatment if ///
>             (geo_unit == "Uruguay" | geo_unit == "Brasil")
  3. end

. 
. main
(23 vars, 3 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      42
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
mortality_w_fertile1996 mortality_w_fertile1997 ... mortality_w_fertile2016->mo
> rtality_w_fertile
-----------------------------------------------------------------------------
(note: file ..\temp\mortality_w_fertile.dta not found)
file ..\temp\mortality_w_fertile.dta saved
(23 vars, 3 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      42
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
maternal_mortality1996 maternal_mortality1997 ... maternal_mortality2016->mater
> nal_mortality
-----------------------------------------------------------------------------
(note: file ..\temp\maternal_mortality.dta not found)
file ..\temp\maternal_mortality.dta saved
(23 vars, 7 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        6   ->     126
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
tot_mortality_w_fertile1996 tot_mortality_w_fertile1997 ... tot_mortality_w_fer
> tile2016->tot_mortality_w_fertile
-----------------------------------------------------------------------------
(note: file ..\temp\tot_mortality_w_fertile.dta not found)
file ..\temp\tot_mortality_w_fertile.dta saved
(23 vars, 7 obs)
(1 observation deleted)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015 2016)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        6   ->     126
Number of variables                  23   ->       4
j variable (21 values)                    ->   year
xij variables:
tot_maternal_mortality1996 tot_maternal_mortality1997 ... tot_maternal_mortalit
> y2016->tot_maternal_mortality
-----------------------------------------------------------------------------
(note: file ..\temp\tot_maternal_mortality.dta not found)
file ..\temp\tot_maternal_mortality.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                42  
    -----------------------------------------
(21 real changes made)
(21 observations deleted)
(note: file ..\temp\rgds_mm_ratio.dta not found)
file ..\temp\rgds_mm_ratio.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               126  
    -----------------------------------------
(105 observations deleted)
(21 real changes made)
       panel variable:  geo_unit_num (strongly balanced)
        time variable:  year, 1996 to 2016
                delta:  1 unit
The smoother applied was
     by geo_unit_num : (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)];
     x(t)= mm_ratio
(note: file ..\temp\brasil_mm_data.dta not found)
file ..\temp\brasil_mm_data.dta saved
(85 observations deleted)
        time variable:  year, 1985 to 2015
                delta:  1 unit
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)=
     MuertesMaternas
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= Raz
The smoother applied was
     (1/5)*[x(t-2) + x(t-1) + 1*x(t) + x(t+1) + x(t+2)]; x(t)= mm_ratio
(note: file ..\temp\uruguay_mm_data.dta not found)
file ..\temp\uruguay_mm_data.dta saved
(file ../output/mortality_ma_mm_ratio.pdf written in PDF format)
(file ../output/mortality_mm_ratio.pdf written in PDF format)

      Source |       SS           df       MS      Number of obs   =        52
-------------+----------------------------------   F(3, 48)        =    265.45
       Model |  .002045918         3  .000681973   Prob > F        =    0.0000
    Residual |  .000123319        48  2.5692e-06   R-squared       =    0.9432
-------------+----------------------------------   Adj R-squared   =    0.9396
       Total |  .002169237        51  .000042534   Root MSE        =     .0016

------------------------------------------------------------------------------
 ma_mm_ratio |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.post |  -.0015487   .0007203    -2.15   0.037    -.0029968   -.0001005
 1.treatment |  -.0110347   .0006755   -16.33   0.000     -.012393   -.0096764
             |
        post#|
   treatment |
        1 1  |  -.0036801   .0009317    -3.95   0.000    -.0055535   -.0018068
             |
       _cons |    .027051   .0005667    47.73   0.000     .0259116    .0281904
------------------------------------------------------------------------------

      Source |       SS           df       MS      Number of obs   =        52
-------------+----------------------------------   F(3, 48)        =     44.89
       Model |  .002022188         3  .000674063   Prob > F        =    0.0000
    Residual |  .000720793        48  .000015017   R-squared       =    0.7372
-------------+----------------------------------   Adj R-squared   =    0.7208
       Total |  .002742981        51  .000053784   Root MSE        =    .00388

------------------------------------------------------------------------------
    mm_ratio |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.post |  -.0013097   .0017413    -0.75   0.456    -.0048108    .0021915
 1.treatment |  -.0105274   .0016332    -6.45   0.000    -.0138112   -.0072436
             |
        post#|
   treatment |
        1 1  |  -.0043652   .0022525    -1.94   0.059    -.0088942    .0001638
             |
       _cons |   .0268114   .0013701    19.57   0.000     .0240568    .0295661
------------------------------------------------------------------------------

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./vital_records.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./vital_records.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata14\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata14\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
. program main    
  1.         *global y_date_rivera = 2010
.         do ../../globals.do
  2.         
.         foreach var in not_married first_pregnancy age_young high_school reco
> mm_prenatal_numvisits {
  3.                 plot_births_case_studies, treatment(rivera) by_vars(`var')
>  time(anio_sem)
  4.                 plot_births_case_studies, treatment(rivera) by_vars(`var')
>  time(anio)
  5.         }
  6. 
.         foreach time in anio anio_sem {
  7.                 grc1leg g_`time'_not_marri_0 g_`time'_not_marri_1 g_`time'
> _first_pre_0 ///
>                                 g_`time'_first_pre_1 g_`time'_age_young_0 g_`
> time'_age_young_1 ///
>                         , cols(2) legendfrom(g_`time'_not_marri_0) position(6
> ) ///
>                           graphregion(color(white)) name(g_`time')
  8.                 graph display g_`time', ysiz(18) xsiz(15)
  9.                 graph export "..\output\births_rivera_`time'.pdf", replace
 10.         }
 11. end

. 
. capture program drop plot_births_case_studies

. program plot_births_case_studies
  1. syntax, by_vars(string) treatment(string) time(string) 
  2.         
.         use "..\..\..\assign_treatment\output\births.dta", clear
  3. 
.         if "`time'" == "anio_sem" {
  4.         local range "if inrange(`time', th(${s_date_`treatment'}) - ${s_pr
> e},th(${s_date_`treatment'}) + ${s_post}) "
  5.         local xtitle "Year-half"
  6.         local vertical = th(${s_date_`treatment'}) - 0.5   
  7.         local vertical2= th(${s_date_`treatment'}) + 1.5 
  8.         local y_label = "0(500)1000"
  9.     }
 10.     else {
 11.         local range "if inrange(`time', ${y_date_`treatment'} - ${y_pre}, 
> ${y_date_`treatment'} + ${y_post}) "
 12.         local xtitle "Year"
 13.         local vertical = ${y_date_`treatment'} - 0.5  
 14.         local vertical2= ${y_date_`treatment'} + 0.5
 15.         local y_label = "0(600)1800"
 16.     }
 17.         
.         collapse (count) births=edad , by(`time' treatment_`treatment' `by_va
> rs')
 18.         
.         keep if !mi(treatment)
 19.         gen Treatment = births if treatment_`treatment'==1
 20.         gen Control   = births if treatment_`treatment'==0
 21.         
.         /*tw (scatter Treatment `time' `range', connect(l) mc(blue) lc(blue))
>  ///
>            (scatter Control   `time' `range', connect(l) mc(red)  lc(red)) //
> /
>            ,  by(`by_vars', title(${legend_`treatment'}))  ///
>            tline(`vertical' `vertical2', lcolor(black) lpattern(dot)) ///
>            xtitle("`xtitle'") xsize(8) ///
>            scheme(s1color) 
> 
>         graph export "..\output\births_`treatment'_`time'_`by_vars'.pdf", rep
> lace*/
. 
.         local g_name = substr("`by_vars'",1,9)
 22.         local opt1 = `"tline(`vertical' `vertical2', lcolor(black) lpatter
> n(dot)) xsize(4) scheme(s1color) "'
 23.         local opt2 = `"ylabel(`y_label', labs(small)) xlabel(, labs(small)
> ) xtitle("`xtitle'", si(small)) legend(si(vsmall))"'
 24.         forvalues v=0/1 {
 25.                 tw (scatter Treatment `time' `range' & `by_vars'==`v', con
> nect(l) mc(blue) lc(blue) ) ///
>                    (scatter Control   `time' `range' & `by_vars'==`v', connec
> t(l) mc(red)  lc(red)) ///
>                         , `opt1' `opt2' title(`: label `by_vars' `v'', si(med
> ium)) name(g_`time'_`g_name'_`v')
 26.         }
 27. end

. 
. capture program drop diff_in_diff

. program diff_in_diff
  1. syntax, by_vars(string) treatment(string) time(string)
  2.         
.         use "..\..\..\assign_treatment\output\births.dta", clear
  3. 
.         local treatment rivera
  4.         local time anio
  5.         local by_vars first_pregnancy
  6. 
.         if "`time'" == "anio_sem" {
  7.         local range "if inrange(`time', th(${s_date_`treatment'}) - ${s_pr
> e},th(${s_date_`treatment'}) + ${s_post}) "
  8.         local event_date         ${s_date_`treatment'}  
  9.         gen post = (`time' >= th(${s_date_`treatment'}))   
 10.     }
 11.     else {
 12.         local range "if inrange(`time', ${y_date_`treatment'} - ${y_pre}, 
> ${y_date_`treatment'} + ${y_post}) "
 13.         local event_date ${y_date_`treatment'}  
 14.         gen post = (`time' >=  ${y_date_`treatment'})  
 15.     }
 16.         
.         keep if !mi(treatment_`treatment')
 17.         
.         reg edad post##treatment_`treatment'
 18. 
.         collapse (count) births=edad , by(anio treatment_`treatment' first_pr
> egnancy not_married) //`by_vars')
 19.                 
.                 gen post = (anio>`event_date')
 20.                 gen interaction = post * treatment_`treatment'
 21.                 gen log_births = log(births)
 22.                 
.                 reg log_births post##treatment_`treatment'##first_pregnancy##
> not_married
 23. end

. 
. main

.     * Dates of treatments
.     global m_date_mvd     "2004m4"

.     global m_date_florida "2008m8"

.     global m_date_rivera  "2010m6"

.     global m_date_salto   "2013m1"

.     
.     global q_date_mvd     "2004q2"

.     global q_date_florida "2008q3"

.     global q_date_rivera  "2010q3"

.     global q_date_salto   "2013q1"

.     
.     global s_date_mvd     "2004h1"

.     global s_date_florida "2008h2"

.     global s_date_rivera  "2010h2"

.     global s_date_salto   "2013h1"

.     
.     global y_date_mvd     2004 

.     global y_date_florida 2008

.     global y_date_rivera  2010 

.     global y_date_salto   2013 

. 
.     * Ranges
.     global m_pre  48

.     global m_post 24

.     global q_pre  16

.     global q_post 12

.     global s_pre  8

.     global s_post 4

.     global y_pre  4

.     global y_post 2

. 
.     * Ranges SCM (to build synth control)
.     global q_scm_pre  30

.     global q_scm_post 16

.     global s_scm_pre  20

.     global s_scm_post 8

.     global y_scm_pre  10

.     global y_scm_post 4

. 
.     *Lag list (related to Ranges SCM)
.     global q_lag_list " 8 9 10 11 12 13 14 15 16" //`" 1 3 5 7 "'

.     global s_lag_list " 8 9 10 11 12 13 14 15 16 17 18 19 20 " //`" 5 6 7 8 9
>  10 11 12 "'

.     global y_lag_list " 2 3 4 5 6 7 " //`" 3 4 5 6 "'

. 
.     * Legends
.     global legend_mvd    = "Montevideo"

.     global legend_rivera = "Rivera"

.     global legend_salto  = "Salto"

.     global legend_florida  = "Florida"

. 
end of do-file
(102 observations deleted)
(102 missing values generated)
(100 missing values generated)
(51 observations deleted)
(51 missing values generated)
(51 missing values generated)
(102 observations deleted)
(92 missing values generated)
(87 missing values generated)
(51 observations deleted)
(50 missing values generated)
(46 missing values generated)
(68 observations deleted)
(68 missing values generated)
(68 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(68 observations deleted)
(68 missing values generated)
(68 missing values generated)
(34 observations deleted)
(34 missing values generated)
(34 missing values generated)
(102 observations deleted)
(98 missing values generated)
(96 missing values generated)
(51 observations deleted)
(50 missing values generated)
(50 missing values generated)
(file ..\output\births_rivera_anio.pdf written in PDF format)
(file ..\output\births_rivera_anio_sem.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./state_of_birth.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./state_of_birth.do 

. clear all

. set more off

. adopath + ../../../library/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files (x86)\Stata14\ado\base/"
  [2]  (SITE)      "C:\Program Files (x86)\Stata14\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../library/stata/gslab_misc/ado"

. 
.         use "..\..\..\assign_treatment\output\births.dta", clear

.         drop if inlist(depar,20,99) // drop Extranjero, No indicado
(0 observations deleted)

. 
.         collapse (count) births = edad, by(anio codep depar)

.         egen births_tot = total(births), by(anio depar)

.         gen births_sh = births/births_tot

.         
.         gen tag_same = depar==codep

.         gen tag_mvd  = codep==10

.         gen births_sh_same = births/births_tot if tag_same
(2,122 missing values generated)

.         gen births_sh_mvd  = births/births_tot if tag_mvd
(2,122 missing values generated)

. 
.         collapse (max) births_sh_same births_sh_mvd, by(anio depar)

.         xtset depar anio
       panel variable:  depar (strongly balanced)
        time variable:  anio, 1999 to 2015
                delta:  1 unit

.         label var anio "Birth year"

.         label var births_sh_same "Share of births in same state"

.         label var births_sh_mvd  "Share of births in Montevideo"

.         label var    depar "Mother's residential state"

. 
.         foreach x in same mvd {
  2.                 egen min_sh_`x' = min(births_sh_`x'), by(depar)
  3.                 qui sum min_sh_`x', det
  4.                 gen tag_`x' = (min_sh_`x'> r(p50))
  5.         }

. 
.         local plot_lines  = "plot1(lp(shortdash)) plot2(lp(shortdash)) plot3(
> lp(shortdash)) plot4(lp(shortdash)) plot5(lp(shortdash))"

.         local legend_all  = "legend(cols(7) symx(3) si(vsmall) bex)"

.         local legend_mvd  = "legend(off)"

.         local legend_same = "legend(rows(3) symx(5) si(small))"

.         local legend_mvd  = "legend(off)"

.         foreach x in same mvd {
  2.                 xtline births_sh_`x', ov ylabel(0 (.2) 1 ) name(`x') ///
>                         graphregion(color(white)) `legend_all' `plot_lines'
  3.                 qui sum births_sh_`x'
  4.                 local min_`x' = floor(`r(min)'*5) / 5
  5.                 forvalues tag = 0/1 {
  6.                         xtline births_sh_`x' if tag_`x'==`tag', ov ylabel(
> `min_`x'' (.2) 1 ) name(`x'_`tag') ///
>                                 graphregion(color(white)) `legend_`x''
  7.                 }
  8.         }

.         
.         graph combine mvd_0 mvd_1 same_0 same_1, ysiz(6) xsiz(10) graphregion
> (color(white)) scale(0.8) 

.         graph export "..\output\births_sh_2groups.pdf", replace
(file ..\output\births_sh_2groups.pdf written in PDF format)

. 
.         grc1leg same mvd, rows(1) legendfrom(same) position(6) cols(2) graphr
> egion(color(white))

.         graph export "..\output\births_sh_1group.pdf", replace
(file ..\output\births_sh_1group.pdf written in PDF format)

. 
.         graph drop same_0 same_1 mvd_0 mvd_1 same mvd

. 
. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./aggregate_births.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./aggregate_births.do 

. clear all

. set more off

. 
. program main
  1.         clean_data
  2.          plot_natality, rescale(1000)
  3. end

. 
. program clean_data
  1.         import excel using "..\..\..\raw\Cuadro 5. Tasas Brutas de Mortali
> dad y Natalidad. Uruguay, 1996-2015.xlsx" ///
>                   , clear cellrange(a39:bi62)
  2. 
.         local i = 0
  3.         foreach x of varlist * {
  4.            rename `x' var`i'
  5.            local i = `i' + 1
  6.         }
  7. 
.         rename var0 dpto
  8. 
.         local j1 = 2
  9.         forvalues year = 1996/2015 {
 10.                 local j0 = `j1' - 1
 11.                 local j2 = `j1' + 1
 12.                 replace var`j1' = "`year'" if mi(var`j1') in 1
 13.                 replace var`j2' = "`year'" if mi(var`j2') in 1
 14.                 assert var`j0'[1] == var`j1'[1] & var`j1'[1] == var`j2'[1]
 15.                 rename var`j0' nat_level`year'
 16.                 rename var`j1' population`year'
 17.                 rename var`j2' nat_rate`year'
 18.                 local j1 = `j1' + 3
 19.         }
 20. 
.         drop in 22/23
 21.         drop in 1/2 
 22. 
.         destring , replace
 23.         local nn=_N+1
 24.         set obs `nn'
 25.         replace dpto = "Area Metropolitana" in `nn'
 26.         forvalues year = 1996/2015 {
 27.                 replace nat_level`year' = nat_level`year'[2] + nat_level`y
> ear'[10] in `nn'
 28.                 replace population`year' = population`year'[2] + populatio
> n`year'[10] in `nn'
 29.         }
 30. 
.         foreach var in nat_level nat_rate population {
 31.                 preserve 
 32.                         keep    dpto `var'*
 33.                         reshape long `var', i(dpto) j(year)
 34.                         tempfile     `var'
 35.                         save        ``var''
 36.                 restore
 37.         }
 38. 
.         use `nat_level', clear
 39.         merge 1:1 dpto year using `nat_rate'  , nogen assert(3)
 40.         merge 1:1 dpto year using `population', nogen assert(3)
 41. 
.         encode dpto, g(dpto_num)
 42.         xtset  dpto_num year
 43.         gen nat_rate2 = nat_level/population*1000
 44. end

. 
. program plot_natality
  1. syntax, rescale(int)
  2.         gen nat_level_`rescale'= nat_level/`rescale'
  3.         label var nat_level_`rescale' "Births (`rescale's)"
  4.         local opts = "overlay graphregion(fcolor(white) lcolor(white)) yla
> b(#3) legend(rows(1))"
  5.         local opt12 = "plot2(recast(con) lc(red) mc(red)) plot1(recast(con
> ) lc(blue) mc(blue)) legend(order(1 2)) "
  6.         local opt21 = "plot1(recast(con) lc(red) mc(red)) plot2(recast(con
> ) lc(blue) mc(blue)) legend(order(2 1)) "
  7. 
.         xtline nat_level_`rescale' if (dpto=="Total"|dpto=="Montevideo") & in
> range(year,2000,2006) ///
>                 , `opts' `opt12' tline(2003.5, lcolor(black) lpattern(dot)) n
> ame(mvd, replace)
  8.         xtline nat_level_`rescale' if (dpto=="Florida"|dpto=="Colonia") & 
> inrange(year,2004,2010) ///
>                 , `opts' `opt21' tline(2007.5, lcolor(black) lpattern(dot)) n
> ame(flo, replace) 
  9.         xtline nat_level_`rescale' if (dpto=="Rivera"|dpto=="Artigas") & i
> nrange(year,2006,2012) ///
>                 , `opts' `opt21' tline(2009.5, lcolor(black) lpattern(dot)) n
> ame(riv, replace) 
 10.         xtline nat_level_`rescale' if (dpto=="Salto"|dpto=="Paysandu") & i
> nrange(year,2008,2014) ///
>                 , `opts' `opt21' tline(2011.5, lcolor(black) lpattern(dot)) n
> ame(sal, replace) 
 11.                 
.         graph combine mvd flo riv sal, cols(2) ysize(7) xsize(10) graphregion
> (fcolor(white))
 12.         graph export ../output/natality_`rescale'.pdf, replace
 13.         graph drop _all
 14. end

. 
. main
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(2 observations deleted)
(2 observations deleted)
dpto: contains nonnumeric characters; no replace
nat_level1996: all characters numeric; replaced as long
population1996: all characters numeric; replaced as double
nat_rate1996: all characters numeric; replaced as double
nat_level1997: all characters numeric; replaced as long
population1997: all characters numeric; replaced as double
nat_rate1997: all characters numeric; replaced as double
nat_level1998: all characters numeric; replaced as long
population1998: all characters numeric; replaced as double
nat_rate1998: all characters numeric; replaced as double
nat_level1999: all characters numeric; replaced as long
population1999: all characters numeric; replaced as double
nat_rate1999: all characters numeric; replaced as double
nat_level2000: all characters numeric; replaced as long
population2000: all characters numeric; replaced as double
nat_rate2000: all characters numeric; replaced as double
nat_level2001: all characters numeric; replaced as long
population2001: all characters numeric; replaced as double
nat_rate2001: all characters numeric; replaced as double
nat_level2002: all characters numeric; replaced as long
population2002: all characters numeric; replaced as double
nat_rate2002: all characters numeric; replaced as double
nat_level2003: all characters numeric; replaced as long
population2003: all characters numeric; replaced as double
nat_rate2003: all characters numeric; replaced as double
nat_level2004: all characters numeric; replaced as long
population2004: all characters numeric; replaced as double
nat_rate2004: all characters numeric; replaced as double
nat_level2005: all characters numeric; replaced as long
population2005: all characters numeric; replaced as double
nat_rate2005: all characters numeric; replaced as double
nat_level2006: all characters numeric; replaced as long
population2006: all characters numeric; replaced as double
nat_rate2006: all characters numeric; replaced as double
nat_level2007: all characters numeric; replaced as long
population2007: all characters numeric; replaced as double
nat_rate2007: all characters numeric; replaced as double
nat_level2008: all characters numeric; replaced as long
population2008: all characters numeric; replaced as double
nat_rate2008: all characters numeric; replaced as double
nat_level2009: all characters numeric; replaced as long
population2009: all characters numeric; replaced as double
nat_rate2009: all characters numeric; replaced as double
nat_level2010: all characters numeric; replaced as long
population2010: all characters numeric; replaced as double
nat_rate2010: all characters numeric; replaced as double
nat_level2011: all characters numeric; replaced as long
population2011: all characters numeric; replaced as double
nat_rate2011: all characters numeric; replaced as double
nat_level2012: all characters numeric; replaced as long
population2012: all characters numeric; replaced as double
nat_rate2012: all characters numeric; replaced as double
nat_level2013: all characters numeric; replaced as long
population2013: all characters numeric; replaced as double
nat_rate2013: all characters numeric; replaced as double
nat_level2014: all characters numeric; replaced as long
population2014: all characters numeric; replaced as double
nat_rate2014: all characters numeric; replaced as double
nat_level2015: all characters numeric; replaced as long
population2015: all characters numeric; replaced as double
nat_rate2015: all characters numeric; replaced as double
number of observations (_N) was 20, now 21
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
nat_level1996 nat_level1997 ... nat_level2015->nat_level
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000002.tmp saved
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
nat_rate1996 nat_rate1997 ... nat_rate2015->   nat_rate
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000004.tmp saved
(note: j = 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 200
> 9 2010 2011 2012 2013 2014 2015)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       21   ->     420
Number of variables                  21   ->       3
j variable (20 values)                    ->   year
xij variables:
population1996 population1997 ... population2015->population
-----------------------------------------------------------------------------
file C:\Users\dgentil1\AppData\Local\Temp\ST_01000006.tmp saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               420  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               420  
    -----------------------------------------
       panel variable:  dpto_num (strongly balanced)
        time variable:  year, 1996 to 2015
                delta:  1 unit
(file ../output/natality_1000.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./misoprostol.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./misoprostol.do 

. clear all

. set more off

. 
. program main
  1.         import_and_process_data
  2.         build_figure
  3. end

. 
. program import_and_process_data
  1.         import excel using "..\..\..\raw\fernandez_misoprostol.xlsx", ///
>             sheet("Sheet1") firstrow clear
  2.                 
.         gen norm_sales2002 = 100
  3.         gen norm_sales2007 = norm_sales2002 + perc
  4.         gen sales_miso_only2002 = (sales_miso_only2007 * norm_sales2002) /
>  norm_sales2007
  5.         gen ug_per_pop2002 = sales_miso_only2002 / world_bank_pop2002
  6.         gen ug_per_pop2007 = sales_miso_only2007 / world_bank_pop2007
  7.         
.         drop world_bank* sales_miso* perc
  8.         
.         reshape long norm_sales ug_per_pop, i(Region) j(year)
  9.         
.         label var ug_per_pop "Misoprostol (in µg × 10^6) / Population (in mil
> lions)"
 10.         label var year "Year"
 11. end

. 
. program build_figure
  1. 
.     generate order = 1 if Region =="Global"
  2.     replace order = 2 if Region =="Latin America"
  3.     replace order = 3 if Region =="Chile"
  4.     replace order = 4 if Region =="Uruguay"
  5. 
.     graph bar norm_sales, over(year) ///
>             over(Region, sort(order) descending) ///
>             asyvars graphregion(fcolor(white) lcolor(white)) ///
>                 ytitle("Misoprostol annual sales (base 2002)")
  6.                 
.         graph export ../output/misoprostol_sales_2002_2007.pdf, replace
  7.         
.     graph twoway connected ug_per_pop year if Region == "Global" || ///
>             connected ug_per_pop year if Region == "Latin America" || ///
>         connected ug_per_pop year if Region == "Uruguay" || ///
>                 connected ug_per_pop year if Region == "Chile", ///
>                 legend(label(1 "Global") label(2 "Latin America") label(3 "Ur
> uguay") label(4 "Chile")) ///
>                 xlabel(2002(5)2007) graphregion(fcolor(white) lcolor(white))
  8. 
.         graph export ../output/misoprostol_per_capita_2002_2007.pdf, replace
  9. end

. 
. main
(note: j = 2002 2007)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        4   ->       8
Number of variables                   5   ->       4
j variable (2 values)                     ->   year
xij variables:
          norm_sales2002 norm_sales2007   ->   norm_sales
          ug_per_pop2002 ug_per_pop2007   ->   ug_per_pop
-----------------------------------------------------------------------------
(6 missing values generated)
(2 real changes made)
(2 real changes made)
(2 real changes made)
(file ../output/misoprostol_sales_2002_2007.pdf written in PDF format)
(file ../output/misoprostol_per_capita_2002_2007.pdf written in PDF format)

. 
end of do-file


Execute:  "C:\Program Files (x86)\Stata14\StataSE-64.exe" /e do "./google_trends.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

110-user Stata network perpetual license:
       Serial number:  401406206058
         Licensed to:  CIS Department
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./google_trends.do 

. clear all

. set more off

. 
. program main
  1.         import delimited using "..\..\..\raw\google_trends.csv", clear ///
>                  rowrange(4:180) colrange(1:3) varnames(3)   
  2.         label var abortionuruguay "Abortion"
  3.         label var misoprostoluruguay "Misoprostol"
  4.         replace misoprostoluruguay = "1" if misoprostoluruguay=="<1"
  5.         destring misoprostoluruguay, replace
  6.         gen date = monthly(month,"YM")
  7.         format %tm date
  8.         label var date "Month"
  9.         drop month
 10.                 
.         tw line abortion misoprostol date if date<ym(2013,12), ///
>                 tline(2004m04 2005m04 2006m10 2007m10 2008m11 2012m09 2013m06
> , lc(black) lp(dot)) ///
>                 tmlab(2004m04 "(a)" 2005m04 "(b)" 2006m10 "(c)" 2007m10 "(d)"
>  2008m11 "(e)" ///
>                 2012m09 "(f)" 2013m06 "(g)", tp(inside) labs(*0.9) labgap(*.3
> )) ///
>                 tlabel(2004m01(36)2013m01) ttick(#10) lc(blue red) graphregio
> n(fc(white) lc(white))
 11.         graph export ../output/google_trends.pdf, replace
 12. 
. end

. 
. main
(3 vars, 177 obs)
(1 real change made)
misoprostoluruguay: all characters numeric; replaced as byte
(file ../output/google_trends.pdf written in PDF format)

. 
end of do-file

 make.py ended: 2018-09-24 23:49:44
